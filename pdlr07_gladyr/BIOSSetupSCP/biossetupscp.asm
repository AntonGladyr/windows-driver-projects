; Listing generated by Microsoft (R) Optimizing Compiler Version 15.00.30729.207 

	TITLE	c:\radasm\wdk\projects\driver_projects\pdlr07_gladyr\biossetupscp\biossetupscp.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	_serviceName
PUBLIC	_symbolicLinkName
PUBLIC	_imageName
_DATA	SEGMENT
_serviceName DB	'CMOSSetupBIOS', 00H
	ORG $+2
_symbolicLinkName DB '\\.\CMOSSetupBIOS', 00H
	ORG $+2
_imageName DB	'CMOSSetupBIOS.sys', 00H
_DATA	ENDS
PUBLIC	??_C@_0CI@JAMBHPHI@?6IOCTL?$DN0x?$CF08X?5failed?4?5ErrorCode?$DN@ ; `string'
PUBLIC	??_C@_0DA@GLAPKHNB@?6Current?5time?5?$DN?$DO?5?$CF02x?4?$CF02x?4?$CF02x?5@ ; `string'
PUBLIC	__$ArrayPad$
PUBLIC	_ShowCurrentDateTime@4
EXTRN	__imp__GetLastError@0:PROC
EXTRN	__imp__printf:PROC
EXTRN	__imp__DeviceIoControl@32:PROC
EXTRN	___security_cookie:DWORD
EXTRN	@__security_check_cookie@4:PROC
;	COMDAT ??_C@_0CI@JAMBHPHI@?6IOCTL?$DN0x?$CF08X?5failed?4?5ErrorCode?$DN@
; File c:\radasm\wdk\projects\driver_projects\pdlr07_gladyr\biossetupscp\biossetupscp.c
CONST	SEGMENT
??_C@_0CI@JAMBHPHI@?6IOCTL?$DN0x?$CF08X?5failed?4?5ErrorCode?$DN@ DB 0aH, 'I'
	DB	'OCTL=0x%08X failed. ErrorCode=0x%08X.', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0DA@GLAPKHNB@?6Current?5time?5?$DN?$DO?5?$CF02x?4?$CF02x?4?$CF02x?5@
CONST	SEGMENT
??_C@_0DA@GLAPKHNB@?6Current?5time?5?$DN?$DO?5?$CF02x?4?$CF02x?4?$CF02x?5@ DB 0aH
	DB	'Current time => %02x.%02x.%02x %02x:%02x:%02x', 0aH, 00H ; `string'
; Function compile flags: /Odtp
CONST	ENDS
;	COMDAT _ShowCurrentDateTime@4
_TEXT	SEGMENT
_counterBytes$ = -16					; size = 4
_outputBuffer$ = -12					; size = 6
__$ArrayPad$ = -4					; size = 4
_device$ = 8						; size = 4
_ShowCurrentDateTime@4 PROC				; COMDAT

; 4    : {

	npad	2
	push	ebp
	mov	ebp, esp
	sub	esp, 16					; 00000010H
	mov	eax, DWORD PTR ___security_cookie
	xor	eax, ebp
	mov	DWORD PTR __$ArrayPad$[ebp], eax

; 5    : 	UCHAR					outputBuffer[6] = {0};

	mov	BYTE PTR _outputBuffer$[ebp], 0
	xor	eax, eax
	mov	DWORD PTR _outputBuffer$[ebp+1], eax
	mov	BYTE PTR _outputBuffer$[ebp+5], al

; 6    : 	DWORD					counterBytes = 0;

	mov	DWORD PTR _counterBytes$[ebp], 0

; 7    : 	
; 8    : 	if(DeviceIoControl(	device,
; 9    : 						IOCTL_GET_CURRENT_DATE_TIME,
; 10   : 						NULL,
; 11   : 						0,
; 12   : 						&outputBuffer, 
; 13   : 						sizeof(outputBuffer),
; 14   : 						&counterBytes, NULL)	)

	push	0
	lea	ecx, DWORD PTR _counterBytes$[ebp]
	push	ecx
	push	6
	lea	edx, DWORD PTR _outputBuffer$[ebp]
	push	edx
	push	0
	push	0
	push	2236416					; 00222000H
	mov	eax, DWORD PTR _device$[ebp]
	push	eax
	call	DWORD PTR __imp__DeviceIoControl@32
	test	eax, eax
	je	SHORT $LN2@ShowCurren

; 15   : 		
; 16   : 	{
; 17   : 		_tprintf(_TEXT("\nCurrent time => %02x.%02x.%02x %02x:%02x:%02x\n"),
; 18   : 					outputBuffer[0], outputBuffer[1], outputBuffer[2],
; 19   : 					outputBuffer[3], outputBuffer[4], outputBuffer[5]);

	movzx	ecx, BYTE PTR _outputBuffer$[ebp+5]
	push	ecx
	movzx	edx, BYTE PTR _outputBuffer$[ebp+4]
	push	edx
	movzx	eax, BYTE PTR _outputBuffer$[ebp+3]
	push	eax
	movzx	ecx, BYTE PTR _outputBuffer$[ebp+2]
	push	ecx
	movzx	edx, BYTE PTR _outputBuffer$[ebp+1]
	push	edx
	movzx	eax, BYTE PTR _outputBuffer$[ebp]
	push	eax
	push	OFFSET ??_C@_0DA@GLAPKHNB@?6Current?5time?5?$DN?$DO?5?$CF02x?4?$CF02x?4?$CF02x?5@
	call	DWORD PTR __imp__printf
	add	esp, 28					; 0000001cH

; 20   : 	}
; 21   : 	else

	jmp	SHORT $LN3@ShowCurren
$LN2@ShowCurren:

; 22   : 	{
; 23   : 		_tprintf(_TEXT("\nIOCTL=0x%08X failed. ErrorCode=0x%08X."),
; 24   : 					IOCTL_GET_CURRENT_DATE_TIME, GetLastError());

	call	DWORD PTR __imp__GetLastError@0
	push	eax
	push	2236416					; 00222000H
	push	OFFSET ??_C@_0CI@JAMBHPHI@?6IOCTL?$DN0x?$CF08X?5failed?4?5ErrorCode?$DN@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH
$LN3@ShowCurren:

; 25   : 	}
; 26   : 	return;
; 27   : }

	mov	ecx, DWORD PTR __$ArrayPad$[ebp]
	xor	ecx, ebp
	call	@__security_check_cookie@4
	mov	esp, ebp
	pop	ebp
	ret	4
_ShowCurrentDateTime@4 ENDP
_TEXT	ENDS
PUBLIC	??_C@_0DL@OIOIEBPL@Failure?$CB?5The?5value?5must?5be?5betwe@ ; `string'
PUBLIC	??_C@_0DD@GBOLAKFF@Failure?$CB?5The?5value?5must?5be?5a?5num@ ; `string'
PUBLIC	??_C@_04OOCBJMIK@?$CFx?$CFc?$AA@		; `string'
PUBLIC	_inputNumber@8
EXTRN	__imp__getchar:PROC
EXTRN	__imp__scanf:PROC
;	COMDAT ??_C@_0DL@OIOIEBPL@Failure?$CB?5The?5value?5must?5be?5betwe@
CONST	SEGMENT
??_C@_0DL@OIOIEBPL@Failure?$CB?5The?5value?5must?5be?5betwe@ DB 'Failure!'
	DB	' The value must be between 1 and %x. Try again...', 0aH, 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0DD@GBOLAKFF@Failure?$CB?5The?5value?5must?5be?5a?5num@
CONST	SEGMENT
??_C@_0DD@GBOLAKFF@Failure?$CB?5The?5value?5must?5be?5a?5num@ DB 'Failure'
	DB	'! The value must be a number. Try again...', 0aH, 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_04OOCBJMIK@?$CFx?$CFc?$AA@
CONST	SEGMENT
??_C@_04OOCBJMIK@?$CFx?$CFc?$AA@ DB '%x%c', 00H		; `string'
; Function compile flags: /Odtp
CONST	ENDS
;	COMDAT _inputNumber@8
_TEXT	SEGMENT
_c$ = -12						; size = 4
_term$ = -5						; size = 1
_userInput$ = -4					; size = 2
_minValue$ = 8						; size = 2
_maxValue$ = 12						; size = 2
_inputNumber@8 PROC					; COMDAT

; 30   : {

	npad	2
	push	ebp
	mov	ebp, esp
	sub	esp, 12					; 0000000cH

; 31   : 	WORD userInput = 0;

	xor	eax, eax
	mov	WORD PTR _userInput$[ebp], ax
$LN11@inputNumbe:

; 32   : 	TCHAR term;
; 33   : 	int c;
; 34   : 	
; 35   : 	do
; 36   : 	{
; 37   : 		if( _tscanf("%x%c", &userInput, &term) != 2 || term != '\n')

	lea	ecx, DWORD PTR _term$[ebp]
	push	ecx
	lea	edx, DWORD PTR _userInput$[ebp]
	push	edx
	push	OFFSET ??_C@_04OOCBJMIK@?$CFx?$CFc?$AA@
	call	DWORD PTR __imp__scanf
	add	esp, 12					; 0000000cH
	cmp	eax, 2
	jne	SHORT $LN7@inputNumbe
	movsx	eax, BYTE PTR _term$[ebp]
	cmp	eax, 10					; 0000000aH
	je	SHORT $LN8@inputNumbe
$LN7@inputNumbe:

; 38   : 		{
; 39   : 			_tprintf(_TEXT("Failure! The value must be a number. Try again...\n"));

	push	OFFSET ??_C@_0DD@GBOLAKFF@Failure?$CB?5The?5value?5must?5be?5a?5num@
	call	DWORD PTR __imp__printf
	add	esp, 4
$LN6@inputNumbe:

; 40   : 			while ((c = getchar()) != '\n' && c != EOF) { }

	call	DWORD PTR __imp__getchar
	mov	DWORD PTR _c$[ebp], eax
	cmp	DWORD PTR _c$[ebp], 10			; 0000000aH
	je	SHORT $LN5@inputNumbe
	cmp	DWORD PTR _c$[ebp], -1
	je	SHORT $LN5@inputNumbe
	jmp	SHORT $LN6@inputNumbe
$LN5@inputNumbe:

; 41   : 		}
; 42   : 		else

	jmp	SHORT $LN10@inputNumbe
$LN8@inputNumbe:

; 43   : 		{
; 44   : 			if (userInput > maxValue || userInput < minValue )

	movzx	ecx, WORD PTR _userInput$[ebp]
	movzx	edx, WORD PTR _maxValue$[ebp]
	cmp	ecx, edx
	jg	SHORT $LN2@inputNumbe
	movzx	eax, WORD PTR _userInput$[ebp]
	movzx	ecx, WORD PTR _minValue$[ebp]
	cmp	eax, ecx
	jge	SHORT $LN3@inputNumbe
$LN2@inputNumbe:

; 45   : 				_tprintf(_TEXT("Failure! The value must be between 1 and %x. Try again...\n"), maxValue);

	movzx	edx, WORD PTR _maxValue$[ebp]
	push	edx
	push	OFFSET ??_C@_0DL@OIOIEBPL@Failure?$CB?5The?5value?5must?5be?5betwe@
	call	DWORD PTR __imp__printf
	add	esp, 8
	jmp	SHORT $LN10@inputNumbe
$LN3@inputNumbe:

; 46   : 			else break;

	jmp	SHORT $LN9@inputNumbe
$LN10@inputNumbe:

; 47   : 		}
; 48   : 	}
; 49   : 	while(TRUE);

	mov	eax, 1
	test	eax, eax
	jne	$LN11@inputNumbe
$LN9@inputNumbe:

; 50   : 	return userInput;

	mov	ax, WORD PTR _userInput$[ebp]

; 51   : }

	mov	esp, ebp
	pop	ebp
	ret	8
_inputNumber@8 ENDP
_TEXT	ENDS
PUBLIC	??_C@_0DA@JDIJMFMA@?6New?5set?5time?5?$DN?$DO?5?$CF02x?4?$CF02x?4?$CF02x?5@ ; `string'
PUBLIC	??_C@_0BE@KNIOJFPH@Enter?5new?5minutes?3?5?$AA@	; `string'
PUBLIC	??_C@_0BC@CDLIMMCB@Enter?5new?5hours?3?5?$AA@	; `string'
PUBLIC	??_C@_0BG@FGJMKCKM@Enter?5new?5date?5year?3?5?$AA@ ; `string'
PUBLIC	??_C@_0BH@BIJAJBKG@Enter?5new?5date?5month?3?5?$AA@ ; `string'
PUBLIC	??_C@_0BF@FMJEBKL@Enter?5new?5date?5day?3?5?$AA@ ; `string'
PUBLIC	__$ArrayPad$
PUBLIC	_SetNewDateTime@4
;	COMDAT ??_C@_0DA@JDIJMFMA@?6New?5set?5time?5?$DN?$DO?5?$CF02x?4?$CF02x?4?$CF02x?5@
CONST	SEGMENT
??_C@_0DA@JDIJMFMA@?6New?5set?5time?5?$DN?$DO?5?$CF02x?4?$CF02x?4?$CF02x?5@ DB 0aH
	DB	'New set time => %02x.%02x.%02x %02x:%02x:%02x', 0aH, 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BE@KNIOJFPH@Enter?5new?5minutes?3?5?$AA@
CONST	SEGMENT
??_C@_0BE@KNIOJFPH@Enter?5new?5minutes?3?5?$AA@ DB 'Enter new minutes: ', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BC@CDLIMMCB@Enter?5new?5hours?3?5?$AA@
CONST	SEGMENT
??_C@_0BC@CDLIMMCB@Enter?5new?5hours?3?5?$AA@ DB 'Enter new hours: ', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BG@FGJMKCKM@Enter?5new?5date?5year?3?5?$AA@
CONST	SEGMENT
??_C@_0BG@FGJMKCKM@Enter?5new?5date?5year?3?5?$AA@ DB 'Enter new date yea'
	DB	'r: ', 00H					; `string'
CONST	ENDS
;	COMDAT ??_C@_0BH@BIJAJBKG@Enter?5new?5date?5month?3?5?$AA@
CONST	SEGMENT
??_C@_0BH@BIJAJBKG@Enter?5new?5date?5month?3?5?$AA@ DB 'Enter new date mo'
	DB	'nth: ', 00H					; `string'
CONST	ENDS
;	COMDAT ??_C@_0BF@FMJEBKL@Enter?5new?5date?5day?3?5?$AA@
CONST	SEGMENT
??_C@_0BF@FMJEBKL@Enter?5new?5date?5day?3?5?$AA@ DB 'Enter new date day: '
	DB	00H						; `string'
; Function compile flags: /Odtp
CONST	ENDS
;	COMDAT _SetNewDateTime@4
_TEXT	SEGMENT
_counterBytes$ = -24					; size = 4
_outputBuffer$ = -20					; size = 6
_inputBuffer$ = -12					; size = 6
__$ArrayPad$ = -4					; size = 4
_device$ = 8						; size = 4
_SetNewDateTime@4 PROC					; COMDAT

; 54   : {

	npad	2
	push	ebp
	mov	ebp, esp
	sub	esp, 24					; 00000018H
	mov	eax, DWORD PTR ___security_cookie
	xor	eax, ebp
	mov	DWORD PTR __$ArrayPad$[ebp], eax

; 55   : 	UCHAR					inputBuffer[6] = {0};

	mov	BYTE PTR _inputBuffer$[ebp], 0
	xor	eax, eax
	mov	DWORD PTR _inputBuffer$[ebp+1], eax
	mov	BYTE PTR _inputBuffer$[ebp+5], al

; 56   : 	UCHAR					outputBuffer[6] = {0};

	mov	BYTE PTR _outputBuffer$[ebp], 0
	xor	ecx, ecx
	mov	DWORD PTR _outputBuffer$[ebp+1], ecx
	mov	BYTE PTR _outputBuffer$[ebp+5], cl

; 57   : 	DWORD					counterBytes = 0;

	mov	DWORD PTR _counterBytes$[ebp], 0

; 58   : 	
; 59   : 	_tprintf(_TEXT("Enter new date day: "));

	push	OFFSET ??_C@_0BF@FMJEBKL@Enter?5new?5date?5day?3?5?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 4

; 60   : 	inputBuffer[0] = (UCHAR)inputNumber(0x01, 0x31); // day 

	push	49					; 00000031H
	push	1
	call	_inputNumber@8
	mov	BYTE PTR _inputBuffer$[ebp], al

; 61   : 	_tprintf(_TEXT("Enter new date month: "));

	push	OFFSET ??_C@_0BH@BIJAJBKG@Enter?5new?5date?5month?3?5?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 4

; 62   : 	inputBuffer[1] = (UCHAR)inputNumber(0x01, 0x12); // month

	push	18					; 00000012H
	push	1
	call	_inputNumber@8
	mov	BYTE PTR _inputBuffer$[ebp+1], al

; 63   : 	_tprintf(_TEXT("Enter new date year: "));

	push	OFFSET ??_C@_0BG@FGJMKCKM@Enter?5new?5date?5year?3?5?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 4

; 64   : 	inputBuffer[2] = (UCHAR)inputNumber(0x00, 0x99); // year

	push	153					; 00000099H
	push	0
	call	_inputNumber@8
	mov	BYTE PTR _inputBuffer$[ebp+2], al

; 65   : 	_tprintf(_TEXT("Enter new hours: "));

	push	OFFSET ??_C@_0BC@CDLIMMCB@Enter?5new?5hours?3?5?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 4

; 66   : 	inputBuffer[3] = (UCHAR)inputNumber(0x00, 0x23); // hours

	push	35					; 00000023H
	push	0
	call	_inputNumber@8
	mov	BYTE PTR _inputBuffer$[ebp+3], al

; 67   : 	_tprintf(_TEXT("Enter new minutes: "));

	push	OFFSET ??_C@_0BE@KNIOJFPH@Enter?5new?5minutes?3?5?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 4

; 68   : 	inputBuffer[4] = (UCHAR)inputNumber(0x00, 0x59); // minutes

	push	89					; 00000059H
	push	0
	call	_inputNumber@8
	mov	BYTE PTR _inputBuffer$[ebp+4], al

; 69   : 	//_tprintf(_TEXT("Enter new seconds: "));
; 70   : 	//inputBuffer[5] = (UCHAR)inputNumber(0x59); // seconds
; 71   : 	
; 72   : 	if(DeviceIoControl(	device,
; 73   : 						IOCTL_SET_NEW_DATE_TIME,
; 74   : 						&inputBuffer,
; 75   : 						sizeof(inputBuffer),
; 76   : 						&outputBuffer, 
; 77   : 						sizeof(outputBuffer),
; 78   : 						&counterBytes, NULL)	)

	push	0
	lea	edx, DWORD PTR _counterBytes$[ebp]
	push	edx
	push	6
	lea	eax, DWORD PTR _outputBuffer$[ebp]
	push	eax
	push	6
	lea	ecx, DWORD PTR _inputBuffer$[ebp]
	push	ecx
	push	2236420					; 00222004H
	mov	edx, DWORD PTR _device$[ebp]
	push	edx
	call	DWORD PTR __imp__DeviceIoControl@32
	test	eax, eax
	je	SHORT $LN2@SetNewDate

; 79   : 		
; 80   : 	{
; 81   : 		_tprintf(_TEXT("\nNew set time => %02x.%02x.%02x %02x:%02x:%02x\n"),
; 82   : 					outputBuffer[0], outputBuffer[1], outputBuffer[2],
; 83   : 					outputBuffer[3], outputBuffer[4], outputBuffer[5]);

	movzx	eax, BYTE PTR _outputBuffer$[ebp+5]
	push	eax
	movzx	ecx, BYTE PTR _outputBuffer$[ebp+4]
	push	ecx
	movzx	edx, BYTE PTR _outputBuffer$[ebp+3]
	push	edx
	movzx	eax, BYTE PTR _outputBuffer$[ebp+2]
	push	eax
	movzx	ecx, BYTE PTR _outputBuffer$[ebp+1]
	push	ecx
	movzx	edx, BYTE PTR _outputBuffer$[ebp]
	push	edx
	push	OFFSET ??_C@_0DA@JDIJMFMA@?6New?5set?5time?5?$DN?$DO?5?$CF02x?4?$CF02x?4?$CF02x?5@
	call	DWORD PTR __imp__printf
	add	esp, 28					; 0000001cH

; 84   : 	}
; 85   : 	else

	jmp	SHORT $LN3@SetNewDate
$LN2@SetNewDate:

; 86   : 	{
; 87   : 		_tprintf(_TEXT("\nIOCTL=0x%08X failed. ErrorCode=0x%08X."),
; 88   : 					IOCTL_SET_NEW_DATE_TIME, GetLastError());

	call	DWORD PTR __imp__GetLastError@0
	push	eax
	push	2236420					; 00222004H
	push	OFFSET ??_C@_0CI@JAMBHPHI@?6IOCTL?$DN0x?$CF08X?5failed?4?5ErrorCode?$DN@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH
$LN3@SetNewDate:

; 89   : 	}	
; 90   : 	
; 91   : 	return;
; 92   : }

	mov	ecx, DWORD PTR __$ArrayPad$[ebp]
	xor	ecx, ebp
	call	@__security_check_cookie@4
	mov	esp, ebp
	pop	ebp
	ret	4
_SetNewDateTime@4 ENDP
_TEXT	ENDS
PUBLIC	??_C@_0CI@MEFAOOKF@CMOS?5checksum?5status?5is?5bad?5?$CIequ@ ; `string'
PUBLIC	??_C@_0CJ@NGGOJHDM@CMOS?5checksum?5status?5is?5good?5?$CIeq@ ; `string'
PUBLIC	_ShowChecksumStatus@4
;	COMDAT ??_C@_0CI@MEFAOOKF@CMOS?5checksum?5status?5is?5bad?5?$CIequ@
CONST	SEGMENT
??_C@_0CI@MEFAOOKF@CMOS?5checksum?5status?5is?5bad?5?$CIequ@ DB 'CMOS che'
	DB	'cksum status is bad (equals 1)', 0aH, 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0CJ@NGGOJHDM@CMOS?5checksum?5status?5is?5good?5?$CIeq@
CONST	SEGMENT
??_C@_0CJ@NGGOJHDM@CMOS?5checksum?5status?5is?5good?5?$CIeq@ DB 'CMOS che'
	DB	'cksum status is good (equals 0)', 0aH, 00H	; `string'
; Function compile flags: /Odtp
CONST	ENDS
;	COMDAT _ShowChecksumStatus@4
_TEXT	SEGMENT
_checksum$ = -9						; size = 1
_counterBytes$ = -8					; size = 4
_outputBuffer$ = -1					; size = 1
_device$ = 8						; size = 4
_ShowChecksumStatus@4 PROC				; COMDAT

; 95   : {

	npad	2
	push	ebp
	mov	ebp, esp
	sub	esp, 12					; 0000000cH

; 96   : 	UCHAR					outputBuffer = 0;

	mov	BYTE PTR _outputBuffer$[ebp], 0

; 97   : 	UCHAR					checksum = 0;

	mov	BYTE PTR _checksum$[ebp], 0

; 98   : 	DWORD					counterBytes = 0;

	mov	DWORD PTR _counterBytes$[ebp], 0

; 99   : 	
; 100  : 	if(DeviceIoControl(	device,
; 101  : 						IOCTL_GET_DIAGNOSTIC_STATUS,
; 102  : 						NULL,
; 103  : 						0,
; 104  : 						&outputBuffer, 
; 105  : 						sizeof(outputBuffer),
; 106  : 						&counterBytes, NULL)	)

	push	0
	lea	eax, DWORD PTR _counterBytes$[ebp]
	push	eax
	push	1
	lea	ecx, DWORD PTR _outputBuffer$[ebp]
	push	ecx
	push	0
	push	0
	push	2236424					; 00222008H
	mov	edx, DWORD PTR _device$[ebp]
	push	edx
	call	DWORD PTR __imp__DeviceIoControl@32
	test	eax, eax
	je	SHORT $LN4@ShowChecks

; 107  : 		
; 108  : 	{
; 109  : 		// reset all bits except checksum bit
; 110  : 		checksum = outputBuffer & (UCHAR)0x40; // XXXXXXXX AND 01000000. Sixth bit stands for checksum bit

	movzx	eax, BYTE PTR _outputBuffer$[ebp]
	and	eax, 64					; 00000040H
	mov	BYTE PTR _checksum$[ebp], al

; 111  : 		if (!checksum)

	movzx	ecx, BYTE PTR _checksum$[ebp]
	test	ecx, ecx
	jne	SHORT $LN3@ShowChecks

; 112  : 			_tprintf(_TEXT("CMOS checksum status is good (equals 0)\n"));

	push	OFFSET ??_C@_0CJ@NGGOJHDM@CMOS?5checksum?5status?5is?5good?5?$CIeq@
	call	DWORD PTR __imp__printf
	add	esp, 4

; 113  : 		else

	jmp	SHORT $LN2@ShowChecks
$LN3@ShowChecks:

; 114  : 			_tprintf(_TEXT("CMOS checksum status is bad (equals 1)\n"));

	push	OFFSET ??_C@_0CI@MEFAOOKF@CMOS?5checksum?5status?5is?5bad?5?$CIequ@
	call	DWORD PTR __imp__printf
	add	esp, 4
$LN2@ShowChecks:

; 115  : 	}
; 116  : 	else

	jmp	SHORT $LN5@ShowChecks
$LN4@ShowChecks:

; 117  : 	{
; 118  : 		_tprintf(_TEXT("\nIOCTL=0x%08X failed. ErrorCode=0x%08X."),
; 119  : 					IOCTL_GET_DIAGNOSTIC_STATUS, GetLastError());

	call	DWORD PTR __imp__GetLastError@0
	push	eax
	push	2236424					; 00222008H
	push	OFFSET ??_C@_0CI@JAMBHPHI@?6IOCTL?$DN0x?$CF08X?5failed?4?5ErrorCode?$DN@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH
$LN5@ShowChecks:

; 120  : 	}
; 121  : 	return;
; 122  : }

	mov	esp, ebp
	pop	ebp
	ret	4
_ShowChecksumStatus@4 ENDP
_TEXT	ENDS
PUBLIC	??_C@_0CD@FCPAEDAH@CMOS?5battery?5dead?5?$CIflag?5equals?50@ ; `string'
PUBLIC	??_C@_0CJ@PKPBIGK@CMOS?5battery?5power?5good?5?$CIflag?5eq@ ; `string'
PUBLIC	_ShowCMOSBatteryStatus@4
;	COMDAT ??_C@_0CD@FCPAEDAH@CMOS?5battery?5dead?5?$CIflag?5equals?50@
CONST	SEGMENT
??_C@_0CD@FCPAEDAH@CMOS?5battery?5dead?5?$CIflag?5equals?50@ DB 'CMOS bat'
	DB	'tery dead (flag equals 0)', 0aH, 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0CJ@PKPBIGK@CMOS?5battery?5power?5good?5?$CIflag?5eq@
CONST	SEGMENT
??_C@_0CJ@PKPBIGK@CMOS?5battery?5power?5good?5?$CIflag?5eq@ DB 'CMOS batt'
	DB	'ery power good (flag equals 1)', 0aH, 00H	; `string'
; Function compile flags: /Odtp
CONST	ENDS
;	COMDAT _ShowCMOSBatteryStatus@4
_TEXT	SEGMENT
_counterBytes$ = -8					; size = 4
_outputBuffer$ = -2					; size = 1
_cmosBatteryStatus$ = -1				; size = 1
_device$ = 8						; size = 4
_ShowCMOSBatteryStatus@4 PROC				; COMDAT

; 125  : {

	npad	2
	push	ebp
	mov	ebp, esp
	sub	esp, 8

; 126  : 	UCHAR					outputBuffer = 0;

	mov	BYTE PTR _outputBuffer$[ebp], 0

; 127  : 	UCHAR					cmosBatteryStatus = 0;

	mov	BYTE PTR _cmosBatteryStatus$[ebp], 0

; 128  : 	DWORD					counterBytes = 0;

	mov	DWORD PTR _counterBytes$[ebp], 0

; 129  : 	
; 130  : 	if(DeviceIoControl(	device,
; 131  : 						IOCTL_GET_STATUS_REGISTER_D,
; 132  : 						NULL,
; 133  : 						0,
; 134  : 						&outputBuffer, 
; 135  : 						sizeof(outputBuffer),
; 136  : 						&counterBytes, NULL)	)

	push	0
	lea	eax, DWORD PTR _counterBytes$[ebp]
	push	eax
	push	1
	lea	ecx, DWORD PTR _outputBuffer$[ebp]
	push	ecx
	push	0
	push	0
	push	2236428					; 0022200cH
	mov	edx, DWORD PTR _device$[ebp]
	push	edx
	call	DWORD PTR __imp__DeviceIoControl@32
	test	eax, eax
	je	SHORT $LN4@ShowCMOSBa

; 137  : 		
; 138  : 	{
; 139  : 		// reset all bits except checksum bit
; 140  : 		// XXXXXXXX AND 10000000. Seventh bit stands for battery status bit
; 141  : 		cmosBatteryStatus = outputBuffer & (UCHAR)0x80;

	movzx	eax, BYTE PTR _outputBuffer$[ebp]
	and	eax, 128				; 00000080H
	mov	BYTE PTR _cmosBatteryStatus$[ebp], al

; 142  : 		if (cmosBatteryStatus)

	movzx	ecx, BYTE PTR _cmosBatteryStatus$[ebp]
	test	ecx, ecx
	je	SHORT $LN3@ShowCMOSBa

; 143  : 			_tprintf(_TEXT("CMOS battery power good (flag equals 1)\n"));

	push	OFFSET ??_C@_0CJ@PKPBIGK@CMOS?5battery?5power?5good?5?$CIflag?5eq@
	call	DWORD PTR __imp__printf
	add	esp, 4

; 144  : 		else

	jmp	SHORT $LN2@ShowCMOSBa
$LN3@ShowCMOSBa:

; 145  : 			_tprintf(_TEXT("CMOS battery dead (flag equals 0)\n"));

	push	OFFSET ??_C@_0CD@FCPAEDAH@CMOS?5battery?5dead?5?$CIflag?5equals?50@
	call	DWORD PTR __imp__printf
	add	esp, 4
$LN2@ShowCMOSBa:

; 146  : 	}
; 147  : 	else

	jmp	SHORT $LN5@ShowCMOSBa
$LN4@ShowCMOSBa:

; 148  : 	{
; 149  : 		_tprintf(_TEXT("\nIOCTL=0x%08X failed. ErrorCode=0x%08X."),
; 150  : 					IOCTL_GET_STATUS_REGISTER_D, GetLastError());

	call	DWORD PTR __imp__GetLastError@0
	push	eax
	push	2236428					; 0022200cH
	push	OFFSET ??_C@_0CI@JAMBHPHI@?6IOCTL?$DN0x?$CF08X?5failed?4?5ErrorCode?$DN@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH
$LN5@ShowCMOSBa:

; 151  : 	}
; 152  : 	return;
; 153  : }

	mov	esp, ebp
	pop	ebp
	ret	4
_ShowCMOSBatteryStatus@4 ENDP
_TEXT	ENDS
PUBLIC	??_C@_0BI@LGCNFJIL@?6Press?5?8Enter?8?5to?5exit?6?$AA@ ; `string'
PUBLIC	??_C@_0CN@JEBFDAOH@?6Can?8t?5delete?5service?5?8?$CFs?8?4?5Erro@ ; `string'
PUBLIC	??_C@_0BG@HLANJPHO@?6Service?5?8?$CFs?8?5deleted?$AA@ ; `string'
PUBLIC	??_C@_0CL@DNLIHKOL@?6Can?8t?5stop?5service?5?8?$CFs?8?4?5ErrorC@ ; `string'
PUBLIC	??_C@_0BG@GNCMMNDN@?6Service?5?8?$CFs?8?5stopped?$AA@ ; `string'
PUBLIC	??_C@_0DB@HNPALFON@?6Can?8t?5open?5symbolik?5link?5?8?$CFs?8?4?5@ ; `string'
PUBLIC	??_C@_0CN@NIILNDPD@?6Can?8t?5start?5service?5?8?$CFs?8?4?5Error@ ; `string'
PUBLIC	??_C@_0BO@FMFCEEJB@?6Service?5?8?$CFs?8?5already?5running?$AA@ ; `string'
PUBLIC	??_C@_0BH@EKJNPEMA@?6Service?5?8?$CFs?8?5started?6?$AA@ ; `string'
PUBLIC	??_C@_0CN@LJAJMOLA@?6Can?8t?5create?5service?5?8?$CFs?8?4?5Erro@ ; `string'
PUBLIC	??_C@_0BG@BDOMDCP@?6Service?5?8?$CFs?8?5created?$AA@ ; `string'
PUBLIC	??_C@_0DO@DMADPKCI@?6Can?8t?5get?5full?5path?5for?5service@ ; `string'
PUBLIC	??_C@_0DJ@MAJKNFIF@?6Can?8t?5open?5service?5?8?$CFs?8?4?5ErrorC@ ; `string'
PUBLIC	??_C@_0BF@HJJJKPCP@?6Service?5?8?$CFs?8?5opened?$AA@ ; `string'
PUBLIC	??_C@_0DF@NHKGILHH@?6Can?8t?5open?5Service?5Control?5Mana@ ; `string'
PUBLIC	??_C@_0BO@OGPOAGEO@?O?p?n?c?p?$OA?l?$OA?5?s?o?p?$OA?b?k?$LD?m?m?$PP?5?d?p?$OA?i?b?e?p?n?l?$AA@ ; `string'
PUBLIC	__$ArrayPad$
PUBLIC	_main
EXTRN	__imp__CloseServiceHandle@4:PROC
EXTRN	__imp__DeleteService@4:PROC
EXTRN	__imp__ControlService@12:PROC
EXTRN	__imp__CloseHandle@4:PROC
EXTRN	__imp__CreateFileA@28:PROC
EXTRN	__imp__StartServiceA@12:PROC
EXTRN	__imp__CreateServiceA@52:PROC
EXTRN	__imp__GetFullPathNameA@16:PROC
EXTRN	__imp__OpenServiceA@12:PROC
EXTRN	__imp__OpenSCManagerA@12:PROC
EXTRN	__imp__SetConsoleTitleA@4:PROC
EXTRN	_memset:PROC
;	COMDAT ??_C@_0BI@LGCNFJIL@?6Press?5?8Enter?8?5to?5exit?6?$AA@
CONST	SEGMENT
??_C@_0BI@LGCNFJIL@?6Press?5?8Enter?8?5to?5exit?6?$AA@ DB 0aH, 'Press ''E'
	DB	'nter'' to exit', 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0CN@JEBFDAOH@?6Can?8t?5delete?5service?5?8?$CFs?8?4?5Erro@
CONST	SEGMENT
??_C@_0CN@JEBFDAOH@?6Can?8t?5delete?5service?5?8?$CFs?8?4?5Erro@ DB 0aH, 'C'
	DB	'an''t delete service ''%s''. ErrorCode=0x%0X.', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BG@HLANJPHO@?6Service?5?8?$CFs?8?5deleted?$AA@
CONST	SEGMENT
??_C@_0BG@HLANJPHO@?6Service?5?8?$CFs?8?5deleted?$AA@ DB 0aH, 'Service '''
	DB	'%s'' deleted', 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_0CL@DNLIHKOL@?6Can?8t?5stop?5service?5?8?$CFs?8?4?5ErrorC@
CONST	SEGMENT
??_C@_0CL@DNLIHKOL@?6Can?8t?5stop?5service?5?8?$CFs?8?4?5ErrorC@ DB 0aH, 'C'
	DB	'an''t stop service ''%s''. ErrorCode=0x%0X.', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BG@GNCMMNDN@?6Service?5?8?$CFs?8?5stopped?$AA@
CONST	SEGMENT
??_C@_0BG@GNCMMNDN@?6Service?5?8?$CFs?8?5stopped?$AA@ DB 0aH, 'Service '''
	DB	'%s'' stopped', 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_0DB@HNPALFON@?6Can?8t?5open?5symbolik?5link?5?8?$CFs?8?4?5@
CONST	SEGMENT
??_C@_0DB@HNPALFON@?6Can?8t?5open?5symbolik?5link?5?8?$CFs?8?4?5@ DB 0aH, 'C'
	DB	'an''t open symbolik link ''%s''. ErrorCode=0x%0X.', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0CN@NIILNDPD@?6Can?8t?5start?5service?5?8?$CFs?8?4?5Error@
CONST	SEGMENT
??_C@_0CN@NIILNDPD@?6Can?8t?5start?5service?5?8?$CFs?8?4?5Error@ DB 0aH, 'C'
	DB	'an''t start service ''%s''. ErrorCode=0x%08X.', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BO@FMFCEEJB@?6Service?5?8?$CFs?8?5already?5running?$AA@
CONST	SEGMENT
??_C@_0BO@FMFCEEJB@?6Service?5?8?$CFs?8?5already?5running?$AA@ DB 0aH, 'S'
	DB	'ervice ''%s'' already running', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_0BH@EKJNPEMA@?6Service?5?8?$CFs?8?5started?6?$AA@
CONST	SEGMENT
??_C@_0BH@EKJNPEMA@?6Service?5?8?$CFs?8?5started?6?$AA@ DB 0aH, 'Service '
	DB	'''%s'' started', 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0CN@LJAJMOLA@?6Can?8t?5create?5service?5?8?$CFs?8?4?5Erro@
CONST	SEGMENT
??_C@_0CN@LJAJMOLA@?6Can?8t?5create?5service?5?8?$CFs?8?4?5Erro@ DB 0aH, 'C'
	DB	'an''t create service ''%s''. ErrorCode=0x%0X.', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BG@BDOMDCP@?6Service?5?8?$CFs?8?5created?$AA@
CONST	SEGMENT
??_C@_0BG@BDOMDCP@?6Service?5?8?$CFs?8?5created?$AA@ DB 0aH, 'Service ''%'
	DB	's'' created', 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_0DO@DMADPKCI@?6Can?8t?5get?5full?5path?5for?5service@
CONST	SEGMENT
??_C@_0DO@DMADPKCI@?6Can?8t?5get?5full?5path?5for?5service@ DB 0aH, 'Can'''
	DB	't get full path for service image ''%s''. ErrorCode=0x%0X.', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0DJ@MAJKNFIF@?6Can?8t?5open?5service?5?8?$CFs?8?4?5ErrorC@
CONST	SEGMENT
??_C@_0DJ@MAJKNFIF@?6Can?8t?5open?5service?5?8?$CFs?8?4?5ErrorC@ DB 0aH, 'C'
	DB	'an''t open service ''%s''. ErrorCode=0x%0X.', 0aH, 'Try creat'
	DB	'e...', 00H					; `string'
CONST	ENDS
;	COMDAT ??_C@_0BF@HJJJKPCP@?6Service?5?8?$CFs?8?5opened?$AA@
CONST	SEGMENT
??_C@_0BF@HJJJKPCP@?6Service?5?8?$CFs?8?5opened?$AA@ DB 0aH, 'Service ''%'
	DB	's'' opened', 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_0DF@NHKGILHH@?6Can?8t?5open?5Service?5Control?5Mana@
CONST	SEGMENT
??_C@_0DF@NHKGILHH@?6Can?8t?5open?5Service?5Control?5Mana@ DB 0aH, 'Can'''
	DB	't open Service Control Manager. ErrorCode=0x%0X', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BO@OGPOAGEO@?O?p?n?c?p?$OA?l?$OA?5?s?o?p?$OA?b?k?$LD?m?m?$PP?5?d?p?$OA?i?b?e?p?n?l?$AA@
CONST	SEGMENT
??_C@_0BO@OGPOAGEO@?O?p?n?c?p?$OA?l?$OA?5?s?o?p?$OA?b?k?$LD?m?m?$PP?5?d?p?$OA?i?b?e?p?n?l?$AA@ DB 0cfH
	DB	0f0H, 0eeH, 0e3H, 0f0H, 0e0H, 0ecH, 0e0H, ' ', 0f3H, 0efH, 0f0H
	DB	0e0H, 0e2H, 0ebH, 0b3H, 0edH, 0edH, 0ffH, ' ', 0e4H, 0f0H, 0e0H
	DB	0e9H, 0e2H, 0e5H, 0f0H, 0eeH, 0ecH, 00H	; `string'
; Function compile flags: /Odtp
CONST	ENDS
;	COMDAT _main
_TEXT	SEGMENT
_statusBefore$ = -580					; size = 4
_lastError$ = -576					; size = 4
_serviceStatus$ = -572					; size = 28
_counterBytes$ = -544					; size = 4
_scm$ = -540						; size = 4
_service$ = -536					; size = 4
_device$ = -532						; size = 4
_fullImagePath$ = -528					; size = 520
__$ArrayPad$ = -4					; size = 4
_main	PROC						; COMDAT

; 156  : {

	npad	2
	push	ebp
	mov	ebp, esp
	sub	esp, 580				; 00000244H
	mov	eax, DWORD PTR ___security_cookie
	xor	eax, ebp
	mov	DWORD PTR __$ArrayPad$[ebp], eax

; 157  : 	HANDLE				scm = NULL;

	mov	DWORD PTR _scm$[ebp], 0

; 158  : 	HANDLE				service = NULL;

	mov	DWORD PTR _service$[ebp], 0

; 159  : 	HANDLE				device = INVALID_HANDLE_VALUE;

	mov	DWORD PTR _device$[ebp], -1

; 160  : 	DWORD				counterBytes = 0;

	mov	DWORD PTR _counterBytes$[ebp], 0

; 161  : 	DWORD				lastError = ERROR_SUCCESS;

	mov	DWORD PTR _lastError$[ebp], 0

; 162  : 	DWORD				statusBefore = SERVICE_NOT_INSTALLED;

	mov	DWORD PTR _statusBefore$[ebp], 0

; 163  : 	TCHAR				fullImagePath[2*MAX_PATH] = {0};

	mov	BYTE PTR _fullImagePath$[ebp], 0
	push	519					; 00000207H
	push	0
	lea	eax, DWORD PTR _fullImagePath$[ebp+1]
	push	eax
	call	_memset
	add	esp, 12					; 0000000cH

; 164  : 	SERVICE_STATUS		serviceStatus = {0};

	mov	DWORD PTR _serviceStatus$[ebp], 0
	xor	ecx, ecx
	mov	DWORD PTR _serviceStatus$[ebp+4], ecx
	mov	DWORD PTR _serviceStatus$[ebp+8], ecx
	mov	DWORD PTR _serviceStatus$[ebp+12], ecx
	mov	DWORD PTR _serviceStatus$[ebp+16], ecx
	mov	DWORD PTR _serviceStatus$[ebp+20], ecx
	mov	DWORD PTR _serviceStatus$[ebp+24], ecx

; 165  : 	
; 166  : 	SetConsoleTitle(_TEXT("Програма управління драйвером"));

	push	OFFSET ??_C@_0BO@OGPOAGEO@?O?p?n?c?p?$OA?l?$OA?5?s?o?p?$OA?b?k?$LD?m?m?$PP?5?d?p?$OA?i?b?e?p?n?l?$AA@
	call	DWORD PTR __imp__SetConsoleTitleA@4

; 167  : 	scm = OpenSCManager(NULL, NULL, SC_MANAGER_ALL_ACCESS);

	push	983103					; 000f003fH
	push	0
	push	0
	call	DWORD PTR __imp__OpenSCManagerA@12
	mov	DWORD PTR _scm$[ebp], eax

; 168  : 	if(!scm)

	cmp	DWORD PTR _scm$[ebp], 0
	jne	SHORT $LN23@main

; 169  : 	{
; 170  : 		lastError = GetLastError();

	call	DWORD PTR __imp__GetLastError@0
	mov	DWORD PTR _lastError$[ebp], eax

; 171  : 		_tprintf(_TEXT("\nCan't open Service Control Manager. ErrorCode=0x%0X"), lastError);

	mov	edx, DWORD PTR _lastError$[ebp]
	push	edx
	push	OFFSET ??_C@_0DF@NHKGILHH@?6Can?8t?5open?5Service?5Control?5Mana@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 172  : 		return lastError;

	mov	eax, DWORD PTR _lastError$[ebp]
	jmp	$LN24@main
$LN23@main:

; 173  : 	}
; 174  : 
; 175  : 	service = OpenService(scm, serviceName,	SERVICE_START | SERVICE_STOP);

	push	48					; 00000030H
	push	OFFSET _serviceName
	mov	eax, DWORD PTR _scm$[ebp]
	push	eax
	call	DWORD PTR __imp__OpenServiceA@12
	mov	DWORD PTR _service$[ebp], eax

; 176  : 	if(service)

	cmp	DWORD PTR _service$[ebp], 0
	je	SHORT $LN22@main

; 177  : 	{
; 178  : 		statusBefore |= SERVICE_OPENED;

	mov	ecx, DWORD PTR _statusBefore$[ebp]
	or	ecx, 8
	mov	DWORD PTR _statusBefore$[ebp], ecx

; 179  : 		_tprintf(_TEXT("\nService '%s' opened"), serviceName);

	push	OFFSET _serviceName
	push	OFFSET ??_C@_0BF@HJJJKPCP@?6Service?5?8?$CFs?8?5opened?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 180  : 	}
; 181  : 	else

	jmp	$LN21@main
$LN22@main:

; 182  : 	{
; 183  : 		_tprintf(_TEXT("\nCan't open service '%s'. ErrorCode=0x%0X.\nTry create..."), 
; 184  : 					serviceName, GetLastError());

	call	DWORD PTR __imp__GetLastError@0
	push	eax
	push	OFFSET _serviceName
	push	OFFSET ??_C@_0DJ@MAJKNFIF@?6Can?8t?5open?5service?5?8?$CFs?8?4?5ErrorC@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH

; 185  : 		counterBytes = GetFullPathName(
; 186  : 								imageName,
; 187  : 								sizeof (fullImagePath)/sizeof(TCHAR), 
; 188  : 								fullImagePath, NULL);

	push	0
	lea	edx, DWORD PTR _fullImagePath$[ebp]
	push	edx
	push	520					; 00000208H
	push	OFFSET _imageName
	call	DWORD PTR __imp__GetFullPathNameA@16
	mov	DWORD PTR _counterBytes$[ebp], eax

; 189  : 		if(counterBytes == 0 || counterBytes > sizeof (fullImagePath)/sizeof(TCHAR))

	cmp	DWORD PTR _counterBytes$[ebp], 0
	je	SHORT $LN19@main
	cmp	DWORD PTR _counterBytes$[ebp], 520	; 00000208H
	jbe	SHORT $LN20@main
$LN19@main:

; 190  : 		{
; 191  : 			lastError = GetLastError();

	call	DWORD PTR __imp__GetLastError@0
	mov	DWORD PTR _lastError$[ebp], eax

; 192  : 			_tprintf(_TEXT("\nCan't get full path for service image '%s'. ErrorCode=0x%0X."), 
; 193  : 						imageName, lastError);

	mov	eax, DWORD PTR _lastError$[ebp]
	push	eax
	push	OFFSET _imageName
	push	OFFSET ??_C@_0DO@DMADPKCI@?6Can?8t?5get?5full?5path?5for?5service@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH

; 194  : 		}
; 195  : 		else

	jmp	$LN21@main
$LN20@main:

; 196  : 		{
; 197  : 			service = CreateService(
; 198  : 							scm,
; 199  : 							serviceName,
; 200  : 							serviceName,
; 201  : 							SERVICE_START | SERVICE_STOP | DELETE,
; 202  : 							SERVICE_KERNEL_DRIVER,
; 203  : 							SERVICE_DEMAND_START,
; 204  : 							SERVICE_ERROR_IGNORE,
; 205  : 							fullImagePath,
; 206  : 							NULL, NULL, NULL, NULL, NULL);

	push	0
	push	0
	push	0
	push	0
	push	0
	lea	ecx, DWORD PTR _fullImagePath$[ebp]
	push	ecx
	push	0
	push	3
	push	1
	push	65584					; 00010030H
	push	OFFSET _serviceName
	push	OFFSET _serviceName
	mov	edx, DWORD PTR _scm$[ebp]
	push	edx
	call	DWORD PTR __imp__CreateServiceA@52
	mov	DWORD PTR _service$[ebp], eax

; 207  : 			if(service)

	cmp	DWORD PTR _service$[ebp], 0
	je	SHORT $LN17@main

; 208  : 			{
; 209  : 				statusBefore |= SERVICE_INSTALLED;

	mov	eax, DWORD PTR _statusBefore$[ebp]
	or	eax, 1
	mov	DWORD PTR _statusBefore$[ebp], eax

; 210  : 				_tprintf(_TEXT("\nService '%s' created"), serviceName);

	push	OFFSET _serviceName
	push	OFFSET ??_C@_0BG@BDOMDCP@?6Service?5?8?$CFs?8?5created?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 211  : 			}
; 212  : 			else

	jmp	SHORT $LN21@main
$LN17@main:

; 213  : 			{
; 214  : 				lastError = GetLastError();

	call	DWORD PTR __imp__GetLastError@0
	mov	DWORD PTR _lastError$[ebp], eax

; 215  : 				_tprintf(_TEXT("\nCan't create service '%s'. ErrorCode=0x%0X."),
; 216  : 						 serviceName, lastError);

	mov	ecx, DWORD PTR _lastError$[ebp]
	push	ecx
	push	OFFSET _serviceName
	push	OFFSET ??_C@_0CN@LJAJMOLA@?6Can?8t?5create?5service?5?8?$CFs?8?4?5Erro@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH
$LN21@main:

; 217  : 			}
; 218  : 		}
; 219  : 	}
; 220  : 
; 221  : 	if(service)

	cmp	DWORD PTR _service$[ebp], 0
	je	$LN15@main

; 222  : 	{
; 223  : 		if( StartService(service, 0, NULL) )

	push	0
	push	0
	mov	edx, DWORD PTR _service$[ebp]
	push	edx
	call	DWORD PTR __imp__StartServiceA@12
	test	eax, eax
	je	SHORT $LN14@main

; 224  : 		{
; 225  : 			statusBefore |= SERVICE_STARTED;

	mov	eax, DWORD PTR _statusBefore$[ebp]
	or	eax, 2
	mov	DWORD PTR _statusBefore$[ebp], eax

; 226  : 			_tprintf(_TEXT("\nService '%s' started\n"), serviceName);

	push	OFFSET _serviceName
	push	OFFSET ??_C@_0BH@EKJNPEMA@?6Service?5?8?$CFs?8?5started?6?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 227  : 		}
; 228  : 		else

	jmp	SHORT $LN13@main
$LN14@main:

; 229  : 		{
; 230  : 			lastError = GetLastError();

	call	DWORD PTR __imp__GetLastError@0
	mov	DWORD PTR _lastError$[ebp], eax

; 231  : 			if(ERROR_SERVICE_ALREADY_RUNNING == lastError)

	cmp	DWORD PTR _lastError$[ebp], 1056	; 00000420H
	jne	SHORT $LN12@main

; 232  : 			{
; 233  : 				_tprintf(_TEXT("\nService '%s' already running"), serviceName);

	push	OFFSET _serviceName
	push	OFFSET ??_C@_0BO@FMFCEEJB@?6Service?5?8?$CFs?8?5already?5running?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 234  : 				statusBefore |= SERVICE_RUNNING;

	mov	ecx, DWORD PTR _statusBefore$[ebp]
	or	ecx, 4
	mov	DWORD PTR _statusBefore$[ebp], ecx

; 235  : 			}
; 236  : 			else

	jmp	SHORT $LN13@main
$LN12@main:

; 237  : 			{
; 238  : 				_tprintf(_TEXT("\nCan't start service '%s'. ErrorCode=0x%08X."),
; 239  : 							serviceName, lastError);

	mov	edx, DWORD PTR _lastError$[ebp]
	push	edx
	push	OFFSET _serviceName
	push	OFFSET ??_C@_0CN@NIILNDPD@?6Can?8t?5start?5service?5?8?$CFs?8?4?5Error@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH
$LN13@main:

; 240  : 			}
; 241  : 		}
; 242  : 		
; 243  : 		if( (statusBefore & SERVICE_STARTED) || (statusBefore & SERVICE_RUNNING) )

	mov	eax, DWORD PTR _statusBefore$[ebp]
	and	eax, 2
	jne	SHORT $LN9@main
	mov	ecx, DWORD PTR _statusBefore$[ebp]
	and	ecx, 4
	je	$LN15@main
$LN9@main:

; 244  : 		{
; 245  : 			device = CreateFile(
; 246  : 						symbolicLinkName,
; 247  : 						GENERIC_READ + GENERIC_WRITE, 0, NULL,
; 248  : 						OPEN_EXISTING, 0, NULL);

	push	0
	push	0
	push	3
	push	0
	push	0
	push	-1073741824				; c0000000H
	push	OFFSET _symbolicLinkName
	call	DWORD PTR __imp__CreateFileA@28
	mov	DWORD PTR _device$[ebp], eax

; 249  : 			
; 250  : 			if(INVALID_HANDLE_VALUE == device)

	cmp	DWORD PTR _device$[ebp], -1
	jne	SHORT $LN8@main

; 251  : 			{
; 252  : 				lastError = GetLastError();

	call	DWORD PTR __imp__GetLastError@0
	mov	DWORD PTR _lastError$[ebp], eax

; 253  : 				_tprintf(_TEXT("\nCan't open symbolik link '%s'. ErrorCode=0x%0X."),
; 254  : 							symbolicLinkName, lastError);

	mov	edx, DWORD PTR _lastError$[ebp]
	push	edx
	push	OFFSET _symbolicLinkName
	push	OFFSET ??_C@_0DB@HNPALFON@?6Can?8t?5open?5symbolik?5link?5?8?$CFs?8?4?5@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH

; 255  : 			}
; 256  : 			else

	jmp	SHORT $LN15@main
$LN8@main:

; 257  : 			{
; 258  : 				ShowCurrentDateTime(device);

	mov	eax, DWORD PTR _device$[ebp]
	push	eax
	call	_ShowCurrentDateTime@4

; 259  : 				ShowChecksumStatus(device);

	mov	ecx, DWORD PTR _device$[ebp]
	push	ecx
	call	_ShowChecksumStatus@4

; 260  : 				ShowCMOSBatteryStatus(device);

	mov	edx, DWORD PTR _device$[ebp]
	push	edx
	call	_ShowCMOSBatteryStatus@4

; 261  : 				SetNewDateTime(device);

	mov	eax, DWORD PTR _device$[ebp]
	push	eax
	call	_SetNewDateTime@4

; 262  : 				CloseHandle(device);

	mov	ecx, DWORD PTR _device$[ebp]
	push	ecx
	call	DWORD PTR __imp__CloseHandle@4
$LN15@main:

; 263  : 			}
; 264  : 		}
; 265  : 	}
; 266  : 
; 267  : 	if(statusBefore & SERVICE_STARTED)

	mov	edx, DWORD PTR _statusBefore$[ebp]
	and	edx, 2
	je	SHORT $LN6@main

; 268  : 	{
; 269  : 		if(ControlService(service, SERVICE_CONTROL_STOP, &serviceStatus))

	lea	eax, DWORD PTR _serviceStatus$[ebp]
	push	eax
	push	1
	mov	ecx, DWORD PTR _service$[ebp]
	push	ecx
	call	DWORD PTR __imp__ControlService@12
	test	eax, eax
	je	SHORT $LN5@main

; 270  : 		{
; 271  : 			_tprintf(_TEXT("\nService '%s' stopped"), serviceName);

	push	OFFSET _serviceName
	push	OFFSET ??_C@_0BG@GNCMMNDN@?6Service?5?8?$CFs?8?5stopped?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 272  : 		}
; 273  : 		else

	jmp	SHORT $LN6@main
$LN5@main:

; 274  : 		{
; 275  : 			lastError = GetLastError();

	call	DWORD PTR __imp__GetLastError@0
	mov	DWORD PTR _lastError$[ebp], eax

; 276  : 			_tprintf(_TEXT("\nCan't stop service '%s'. ErrorCode=0x%0X."),
; 277  : 						 serviceName, lastError);

	mov	edx, DWORD PTR _lastError$[ebp]
	push	edx
	push	OFFSET _serviceName
	push	OFFSET ??_C@_0CL@DNLIHKOL@?6Can?8t?5stop?5service?5?8?$CFs?8?4?5ErrorC@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH
$LN6@main:

; 278  : 		}
; 279  : 	}
; 280  : 	if( (statusBefore & SERVICE_INSTALLED) && (SERVICE_STOPPED == serviceStatus.dwCurrentState) )

	mov	eax, DWORD PTR _statusBefore$[ebp]
	and	eax, 1
	je	SHORT $LN3@main
	cmp	DWORD PTR _serviceStatus$[ebp+4], 1
	jne	SHORT $LN3@main

; 281  : 	{
; 282  : 		if( DeleteService(service) )

	mov	ecx, DWORD PTR _service$[ebp]
	push	ecx
	call	DWORD PTR __imp__DeleteService@4
	test	eax, eax
	je	SHORT $LN2@main

; 283  : 		{
; 284  : 			_tprintf(_TEXT("\nService '%s' deleted"), serviceName);

	push	OFFSET _serviceName
	push	OFFSET ??_C@_0BG@HLANJPHO@?6Service?5?8?$CFs?8?5deleted?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 285  : 		}
; 286  : 		else

	jmp	SHORT $LN3@main
$LN2@main:

; 287  : 		{
; 288  : 			lastError = GetLastError();

	call	DWORD PTR __imp__GetLastError@0
	mov	DWORD PTR _lastError$[ebp], eax

; 289  : 			_tprintf(_TEXT("\nCan't delete service '%s'. ErrorCode=0x%0X."),
; 290  : 						 serviceName, lastError);

	mov	edx, DWORD PTR _lastError$[ebp]
	push	edx
	push	OFFSET _serviceName
	push	OFFSET ??_C@_0CN@JEBFDAOH@?6Can?8t?5delete?5service?5?8?$CFs?8?4?5Erro@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH
$LN3@main:

; 291  : 		}
; 292  : 	}
; 293  : 
; 294  : 	CloseServiceHandle(service);

	mov	eax, DWORD PTR _service$[ebp]
	push	eax
	call	DWORD PTR __imp__CloseServiceHandle@4

; 295  : 	CloseServiceHandle(scm);

	mov	ecx, DWORD PTR _scm$[ebp]
	push	ecx
	call	DWORD PTR __imp__CloseServiceHandle@4

; 296  : 	_tprintf(_TEXT("\nPress 'Enter' to exit\n"));

	push	OFFSET ??_C@_0BI@LGCNFJIL@?6Press?5?8Enter?8?5to?5exit?6?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 4

; 297  : 	_gettchar();

	call	DWORD PTR __imp__getchar

; 298  : 	return lastError;

	mov	eax, DWORD PTR _lastError$[ebp]
$LN24@main:

; 299  : }

	mov	ecx, DWORD PTR __$ArrayPad$[ebp]
	xor	ecx, ebp
	call	@__security_check_cookie@4
	mov	esp, ebp
	pop	ebp
	ret	0
_main	ENDP
_TEXT	ENDS
END
