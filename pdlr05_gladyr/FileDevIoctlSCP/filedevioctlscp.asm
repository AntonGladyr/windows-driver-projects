; Listing generated by Microsoft (R) Optimizing Compiler Version 15.00.30729.207 

	TITLE	c:\radasm\wdk\projects\driver_projects\pdlr05_gladyr\filedevioctlscp\filedevioctlscp.c
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	_serviceName
PUBLIC	_symbolicLinkName
PUBLIC	_imageName
_DATA	SEGMENT
_serviceName DB	'FileDevIOCTLDemo', 00H
	ORG $+3
_symbolicLinkName DB '\\.\FileDevIOCTLDemo', 00H
	ORG $+3
_imageName DB	'FileDevIOCTLDemo.sys', 00H
_DATA	ENDS
PUBLIC	??_C@_0BI@LGCNFJIL@?6Press?5?8Enter?8?5to?5exit?6?$AA@ ; `string'
PUBLIC	??_C@_0CN@JEBFDAOH@?6Can?8t?5delete?5service?5?8?$CFs?8?4?5Erro@ ; `string'
PUBLIC	??_C@_0BG@HLANJPHO@?6Service?5?8?$CFs?8?5deleted?$AA@ ; `string'
PUBLIC	??_C@_0CL@DNLIHKOL@?6Can?8t?5stop?5service?5?8?$CFs?8?4?5ErrorC@ ; `string'
PUBLIC	??_C@_0BG@GNCMMNDN@?6Service?5?8?$CFs?8?5stopped?$AA@ ; `string'
PUBLIC	??_C@_0CO@HDLHPMAL@?6Result?5of?5reading?5the?5file?4?5Nei@ ; `string'
PUBLIC	??_C@_0CP@IHPNHJIE@?6IOCTL_NEITHER_WRITE?5failed?4?5Err@ ; `string'
PUBLIC	??_C@_0CG@CPNPLIPC@?6IOCTL_NEITHER_WRITE?5written?5?$CFd?5@ ; `string'
PUBLIC	??_C@_0BF@GBADFODJ@?6Enter?5third?5string?6?$AA@ ; `string'
PUBLIC	??_C@_0CN@BJBMBAI@?6IOCTL_DIRECT_READ?5failed?4?5Error@ ; `string'
PUBLIC	??_C@_0CB@PHIDBDDP@IOCTL_DIRECT_READ?5read?5?$CFd?5bytes?6@ ; `string'
PUBLIC	??_C@_0CN@PIHJCCCG@?6Result?5of?5reading?5the?5file?4?5Dir@ ; `string'
PUBLIC	??_C@_0CO@NHIOEPOB@?6IOCTL_DIRECT_WRITE?5failed?4?5Erro@ ; `string'
PUBLIC	??_C@_0CF@JNFGMALK@?6IOCTL_DIRECT_WRITE?5written?5?$CFd?5b@ ; `string'
PUBLIC	??_C@_0BG@JAJKBBNG@?6Enter?5second?5string?6?$AA@ ; `string'
PUBLIC	??_C@_0CP@DLOLIDNB@?6IOCTL_BUFFERED_READ?5failed?4?5Err@ ; `string'
PUBLIC	??_C@_0CD@BLPPFIAH@IOCTL_BUFFERED_READ?5read?5?$CFd?5byte@ ; `string'
PUBLIC	??_C@_03OFAPEBGM@?$CFs?6?$AA@			; `string'
PUBLIC	??_C@_0CP@JLFJOLBL@?6Result?5of?5reading?5the?5file?4?5Buf@ ; `string'
PUBLIC	??_C@_0DA@CILLFPND@?6IOCTL_BUFFERED_WRITE?5failed?4?5Er@ ; `string'
PUBLIC	??_C@_0CH@CJICLIFN@?6IOCTL_BUFFERED_WRITE?5written?5?$CFd@ ; `string'
PUBLIC	??_C@_02DKCKIIND@?$CFs?$AA@			; `string'
PUBLIC	??_C@_0BF@KAODGIKH@?6Enter?5first?5string?6?$AA@ ; `string'
PUBLIC	??_C@_0DB@HNPALFON@?6Can?8t?5open?5symbolik?5link?5?8?$CFs?8?4?5@ ; `string'
PUBLIC	??_C@_0CN@NIILNDPD@?6Can?8t?5start?5service?5?8?$CFs?8?4?5Error@ ; `string'
PUBLIC	??_C@_0BO@FMFCEEJB@?6Service?5?8?$CFs?8?5already?5running?$AA@ ; `string'
PUBLIC	??_C@_0BG@KCIEGIHK@?6Service?5?8?$CFs?8?5started?$AA@ ; `string'
PUBLIC	??_C@_0CN@LJAJMOLA@?6Can?8t?5create?5service?5?8?$CFs?8?4?5Erro@ ; `string'
PUBLIC	??_C@_0BG@BDOMDCP@?6Service?5?8?$CFs?8?5created?$AA@ ; `string'
PUBLIC	??_C@_0DO@DMADPKCI@?6Can?8t?5get?5full?5path?5for?5service@ ; `string'
PUBLIC	??_C@_0DJ@MAJKNFIF@?6Can?8t?5open?5service?5?8?$CFs?8?4?5ErrorC@ ; `string'
PUBLIC	??_C@_0BF@HJJJKPCP@?6Service?5?8?$CFs?8?5opened?$AA@ ; `string'
PUBLIC	??_C@_0DF@NHKGILHH@?6Can?8t?5open?5Service?5Control?5Mana@ ; `string'
PUBLIC	??_C@_0BO@OGPOAGEO@?O?p?n?c?p?$OA?l?$OA?5?s?o?p?$OA?b?k?$LD?m?m?$PP?5?d?p?$OA?i?b?e?p?n?l?$AA@ ; `string'
PUBLIC	__$ArrayPad$
PUBLIC	_main
EXTRN	__imp__getchar:PROC
EXTRN	__imp__CloseServiceHandle@4:PROC
EXTRN	__imp__DeleteService@4:PROC
EXTRN	__imp__ControlService@12:PROC
EXTRN	__imp__CloseHandle@4:PROC
EXTRN	__imp__DeviceIoControl@32:PROC
EXTRN	_scanf_s:PROC
EXTRN	__imp__CreateFileA@28:PROC
EXTRN	__imp__StartServiceA@12:PROC
EXTRN	__imp__CreateServiceA@52:PROC
EXTRN	__imp__GetFullPathNameA@16:PROC
EXTRN	__imp__OpenServiceA@12:PROC
EXTRN	__imp__printf:PROC
EXTRN	__imp__GetLastError@0:PROC
EXTRN	__imp__OpenSCManagerA@12:PROC
EXTRN	__imp__SetConsoleTitleA@4:PROC
EXTRN	___security_cookie:DWORD
EXTRN	@__security_check_cookie@4:PROC
EXTRN	_memset:PROC
;	COMDAT ??_C@_0BI@LGCNFJIL@?6Press?5?8Enter?8?5to?5exit?6?$AA@
; File c:\radasm\wdk\projects\driver_projects\pdlr05_gladyr\filedevioctlscp\filedevioctlscp.c
CONST	SEGMENT
??_C@_0BI@LGCNFJIL@?6Press?5?8Enter?8?5to?5exit?6?$AA@ DB 0aH, 'Press ''E'
	DB	'nter'' to exit', 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0CN@JEBFDAOH@?6Can?8t?5delete?5service?5?8?$CFs?8?4?5Erro@
CONST	SEGMENT
??_C@_0CN@JEBFDAOH@?6Can?8t?5delete?5service?5?8?$CFs?8?4?5Erro@ DB 0aH, 'C'
	DB	'an''t delete service ''%s''. ErrorCode=0x%0X.', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BG@HLANJPHO@?6Service?5?8?$CFs?8?5deleted?$AA@
CONST	SEGMENT
??_C@_0BG@HLANJPHO@?6Service?5?8?$CFs?8?5deleted?$AA@ DB 0aH, 'Service '''
	DB	'%s'' deleted', 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_0CL@DNLIHKOL@?6Can?8t?5stop?5service?5?8?$CFs?8?4?5ErrorC@
CONST	SEGMENT
??_C@_0CL@DNLIHKOL@?6Can?8t?5stop?5service?5?8?$CFs?8?4?5ErrorC@ DB 0aH, 'C'
	DB	'an''t stop service ''%s''. ErrorCode=0x%0X.', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BG@GNCMMNDN@?6Service?5?8?$CFs?8?5stopped?$AA@
CONST	SEGMENT
??_C@_0BG@GNCMMNDN@?6Service?5?8?$CFs?8?5stopped?$AA@ DB 0aH, 'Service '''
	DB	'%s'' stopped', 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_0CO@HDLHPMAL@?6Result?5of?5reading?5the?5file?4?5Nei@
CONST	SEGMENT
??_C@_0CO@HDLHPMAL@?6Result?5of?5reading?5the?5file?4?5Nei@ DB 0aH, 'Resu'
	DB	'lt of reading the file. Neither method: ', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0CP@IHPNHJIE@?6IOCTL_NEITHER_WRITE?5failed?4?5Err@
CONST	SEGMENT
??_C@_0CP@IHPNHJIE@?6IOCTL_NEITHER_WRITE?5failed?4?5Err@ DB 0aH, 'IOCTL_N'
	DB	'EITHER_WRITE failed. ErrorCode=0x%08X.', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0CG@CPNPLIPC@?6IOCTL_NEITHER_WRITE?5written?5?$CFd?5@
CONST	SEGMENT
??_C@_0CG@CPNPLIPC@?6IOCTL_NEITHER_WRITE?5written?5?$CFd?5@ DB 0aH, 'IOCT'
	DB	'L_NEITHER_WRITE written %d bytes', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0BF@GBADFODJ@?6Enter?5third?5string?6?$AA@
CONST	SEGMENT
??_C@_0BF@GBADFODJ@?6Enter?5third?5string?6?$AA@ DB 0aH, 'Enter third str'
	DB	'ing', 0aH, 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_0CN@BJBMBAI@?6IOCTL_DIRECT_READ?5failed?4?5Error@
CONST	SEGMENT
??_C@_0CN@BJBMBAI@?6IOCTL_DIRECT_READ?5failed?4?5Error@ DB 0aH, 'IOCTL_DI'
	DB	'RECT_READ failed. ErrorCode=0x%08X.', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0CB@PHIDBDDP@IOCTL_DIRECT_READ?5read?5?$CFd?5bytes?6@
CONST	SEGMENT
??_C@_0CB@PHIDBDDP@IOCTL_DIRECT_READ?5read?5?$CFd?5bytes?6@ DB 'IOCTL_DIR'
	DB	'ECT_READ read %d bytes', 0aH, 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_0CN@PIHJCCCG@?6Result?5of?5reading?5the?5file?4?5Dir@
CONST	SEGMENT
??_C@_0CN@PIHJCCCG@?6Result?5of?5reading?5the?5file?4?5Dir@ DB 0aH, 'Resu'
	DB	'lt of reading the file. Direct method: ', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0CO@NHIOEPOB@?6IOCTL_DIRECT_WRITE?5failed?4?5Erro@
CONST	SEGMENT
??_C@_0CO@NHIOEPOB@?6IOCTL_DIRECT_WRITE?5failed?4?5Erro@ DB 0aH, 'IOCTL_D'
	DB	'IRECT_WRITE failed. ErrorCode=0x%08X.', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0CF@JNFGMALK@?6IOCTL_DIRECT_WRITE?5written?5?$CFd?5b@
CONST	SEGMENT
??_C@_0CF@JNFGMALK@?6IOCTL_DIRECT_WRITE?5written?5?$CFd?5b@ DB 0aH, 'IOCT'
	DB	'L_DIRECT_WRITE written %d bytes', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0BG@JAJKBBNG@?6Enter?5second?5string?6?$AA@
CONST	SEGMENT
??_C@_0BG@JAJKBBNG@?6Enter?5second?5string?6?$AA@ DB 0aH, 'Enter second s'
	DB	'tring', 0aH, 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_0CP@DLOLIDNB@?6IOCTL_BUFFERED_READ?5failed?4?5Err@
CONST	SEGMENT
??_C@_0CP@DLOLIDNB@?6IOCTL_BUFFERED_READ?5failed?4?5Err@ DB 0aH, 'IOCTL_B'
	DB	'UFFERED_READ failed. ErrorCode=0x%08X.', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0CD@BLPPFIAH@IOCTL_BUFFERED_READ?5read?5?$CFd?5byte@
CONST	SEGMENT
??_C@_0CD@BLPPFIAH@IOCTL_BUFFERED_READ?5read?5?$CFd?5byte@ DB 'IOCTL_BUFF'
	DB	'ERED_READ read %d bytes', 0aH, 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_03OFAPEBGM@?$CFs?6?$AA@
CONST	SEGMENT
??_C@_03OFAPEBGM@?$CFs?6?$AA@ DB '%s', 0aH, 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_0CP@JLFJOLBL@?6Result?5of?5reading?5the?5file?4?5Buf@
CONST	SEGMENT
??_C@_0CP@JLFJOLBL@?6Result?5of?5reading?5the?5file?4?5Buf@ DB 0aH, 'Resu'
	DB	'lt of reading the file. Buffered method: ', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0DA@CILLFPND@?6IOCTL_BUFFERED_WRITE?5failed?4?5Er@
CONST	SEGMENT
??_C@_0DA@CILLFPND@?6IOCTL_BUFFERED_WRITE?5failed?4?5Er@ DB 0aH, 'IOCTL_B'
	DB	'UFFERED_WRITE failed. ErrorCode=0x%08X.', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0CH@CJICLIFN@?6IOCTL_BUFFERED_WRITE?5written?5?$CFd@
CONST	SEGMENT
??_C@_0CH@CJICLIFN@?6IOCTL_BUFFERED_WRITE?5written?5?$CFd@ DB 0aH, 'IOCTL'
	DB	'_BUFFERED_WRITE written %d bytes', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_02DKCKIIND@?$CFs?$AA@
CONST	SEGMENT
??_C@_02DKCKIIND@?$CFs?$AA@ DB '%s', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_0BF@KAODGIKH@?6Enter?5first?5string?6?$AA@
CONST	SEGMENT
??_C@_0BF@KAODGIKH@?6Enter?5first?5string?6?$AA@ DB 0aH, 'Enter first str'
	DB	'ing', 0aH, 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_0DB@HNPALFON@?6Can?8t?5open?5symbolik?5link?5?8?$CFs?8?4?5@
CONST	SEGMENT
??_C@_0DB@HNPALFON@?6Can?8t?5open?5symbolik?5link?5?8?$CFs?8?4?5@ DB 0aH, 'C'
	DB	'an''t open symbolik link ''%s''. ErrorCode=0x%0X.', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0CN@NIILNDPD@?6Can?8t?5start?5service?5?8?$CFs?8?4?5Error@
CONST	SEGMENT
??_C@_0CN@NIILNDPD@?6Can?8t?5start?5service?5?8?$CFs?8?4?5Error@ DB 0aH, 'C'
	DB	'an''t start service ''%s''. ErrorCode=0x%08X.', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BO@FMFCEEJB@?6Service?5?8?$CFs?8?5already?5running?$AA@
CONST	SEGMENT
??_C@_0BO@FMFCEEJB@?6Service?5?8?$CFs?8?5already?5running?$AA@ DB 0aH, 'S'
	DB	'ervice ''%s'' already running', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_0BG@KCIEGIHK@?6Service?5?8?$CFs?8?5started?$AA@
CONST	SEGMENT
??_C@_0BG@KCIEGIHK@?6Service?5?8?$CFs?8?5started?$AA@ DB 0aH, 'Service '''
	DB	'%s'' started', 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_0CN@LJAJMOLA@?6Can?8t?5create?5service?5?8?$CFs?8?4?5Erro@
CONST	SEGMENT
??_C@_0CN@LJAJMOLA@?6Can?8t?5create?5service?5?8?$CFs?8?4?5Erro@ DB 0aH, 'C'
	DB	'an''t create service ''%s''. ErrorCode=0x%0X.', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BG@BDOMDCP@?6Service?5?8?$CFs?8?5created?$AA@
CONST	SEGMENT
??_C@_0BG@BDOMDCP@?6Service?5?8?$CFs?8?5created?$AA@ DB 0aH, 'Service ''%'
	DB	's'' created', 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_0DO@DMADPKCI@?6Can?8t?5get?5full?5path?5for?5service@
CONST	SEGMENT
??_C@_0DO@DMADPKCI@?6Can?8t?5get?5full?5path?5for?5service@ DB 0aH, 'Can'''
	DB	't get full path for service image ''%s''. ErrorCode=0x%0X.', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0DJ@MAJKNFIF@?6Can?8t?5open?5service?5?8?$CFs?8?4?5ErrorC@
CONST	SEGMENT
??_C@_0DJ@MAJKNFIF@?6Can?8t?5open?5service?5?8?$CFs?8?4?5ErrorC@ DB 0aH, 'C'
	DB	'an''t open service ''%s''. ErrorCode=0x%0X.', 0aH, 'Try creat'
	DB	'e...', 00H					; `string'
CONST	ENDS
;	COMDAT ??_C@_0BF@HJJJKPCP@?6Service?5?8?$CFs?8?5opened?$AA@
CONST	SEGMENT
??_C@_0BF@HJJJKPCP@?6Service?5?8?$CFs?8?5opened?$AA@ DB 0aH, 'Service ''%'
	DB	's'' opened', 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_0DF@NHKGILHH@?6Can?8t?5open?5Service?5Control?5Mana@
CONST	SEGMENT
??_C@_0DF@NHKGILHH@?6Can?8t?5open?5Service?5Control?5Mana@ DB 0aH, 'Can'''
	DB	't open Service Control Manager. ErrorCode=0x%0X', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BO@OGPOAGEO@?O?p?n?c?p?$OA?l?$OA?5?s?o?p?$OA?b?k?$LD?m?m?$PP?5?d?p?$OA?i?b?e?p?n?l?$AA@
CONST	SEGMENT
??_C@_0BO@OGPOAGEO@?O?p?n?c?p?$OA?l?$OA?5?s?o?p?$OA?b?k?$LD?m?m?$PP?5?d?p?$OA?i?b?e?p?n?l?$AA@ DB 0cfH
	DB	0f0H, 0eeH, 0e3H, 0f0H, 0e0H, 0ecH, 0e0H, ' ', 0f3H, 0efH, 0f0H
	DB	0e0H, 0e2H, 0ebH, 0b3H, 0edH, 0edH, 0ffH, ' ', 0e4H, 0f0H, 0e0H
	DB	0e9H, 0e2H, 0e5H, 0f0H, 0eeH, 0ecH, 00H	; `string'
; Function compile flags: /Odtp
CONST	ENDS
;	COMDAT _main
_TEXT	SEGMENT
tv322 = -1224						; size = 4
tv564 = -1217						; size = 1
tv561 = -1216						; size = 4
tv558 = -1212						; size = 4
tv313 = -1208						; size = 4
tv551 = -1201						; size = 1
tv548 = -1200						; size = 4
tv545 = -1196						; size = 4
tv299 = -1192						; size = 4
tv533 = -1185						; size = 1
tv530 = -1184						; size = 4
tv527 = -1180						; size = 4
tv273 = -1176						; size = 4
tv513 = -1169						; size = 1
tv510 = -1168						; size = 4
tv507 = -1164						; size = 4
tv264 = -1160						; size = 4
tv500 = -1153						; size = 1
tv497 = -1152						; size = 4
tv494 = -1148						; size = 4
tv250 = -1144						; size = 4
tv482 = -1137						; size = 1
tv479 = -1136						; size = 4
tv476 = -1132						; size = 4
tv224 = -1128						; size = 4
tv462 = -1121						; size = 1
tv459 = -1120						; size = 4
tv456 = -1116						; size = 4
tv207 = -1112						; size = 4
tv444 = -1105						; size = 1
tv441 = -1104						; size = 4
tv438 = -1100						; size = 4
_statusBefore$ = -1096					; size = 4
_lastError$ = -1092					; size = 4
_serviceStatus$ = -1088					; size = 28
_counterBytes$ = -1060					; size = 4
_scm$ = -1056						; size = 4
_service$ = -1052					; size = 4
_outputBuffer$ = -1048					; size = 256
_device$ = -788						; size = 4
_fullImagePath$ = -784					; size = 520
_inputBuffer$ = -264					; size = 256
__$ArrayPad$ = -4					; size = 4
_main	PROC						; COMDAT

; 4    : {

	npad	2
	push	ebp
	mov	ebp, esp
	sub	esp, 1224				; 000004c8H
	mov	eax, DWORD PTR ___security_cookie
	xor	eax, ebp
	mov	DWORD PTR __$ArrayPad$[ebp], eax

; 5    : 	HANDLE				scm = NULL;

	mov	DWORD PTR _scm$[ebp], 0

; 6    : 	HANDLE				service = NULL;

	mov	DWORD PTR _service$[ebp], 0

; 7    : 	HANDLE				device = INVALID_HANDLE_VALUE;

	mov	DWORD PTR _device$[ebp], -1

; 8    : 	DWORD				counterBytes = 0;

	mov	DWORD PTR _counterBytes$[ebp], 0

; 9    : 	DWORD				lastError = ERROR_SUCCESS;

	mov	DWORD PTR _lastError$[ebp], 0

; 10   : 	DWORD				statusBefore = SERVICE_NOT_INSTALLED;

	mov	DWORD PTR _statusBefore$[ebp], 0

; 11   : 	TCHAR				fullImagePath[2*MAX_PATH] = {0};

	mov	BYTE PTR _fullImagePath$[ebp], 0
	push	519					; 00000207H
	push	0
	lea	eax, DWORD PTR _fullImagePath$[ebp+1]
	push	eax
	call	_memset
	add	esp, 12					; 0000000cH

; 12   : 	SERVICE_STATUS		serviceStatus = {0};

	mov	DWORD PTR _serviceStatus$[ebp], 0
	xor	ecx, ecx
	mov	DWORD PTR _serviceStatus$[ebp+4], ecx
	mov	DWORD PTR _serviceStatus$[ebp+8], ecx
	mov	DWORD PTR _serviceStatus$[ebp+12], ecx
	mov	DWORD PTR _serviceStatus$[ebp+16], ecx
	mov	DWORD PTR _serviceStatus$[ebp+20], ecx
	mov	DWORD PTR _serviceStatus$[ebp+24], ecx

; 13   : 	CHAR				inputBuffer[IN_BUFFER_SIZE]		= {0};	// для драйверу

	mov	BYTE PTR _inputBuffer$[ebp], 0
	push	255					; 000000ffH
	push	0
	lea	edx, DWORD PTR _inputBuffer$[ebp+1]
	push	edx
	call	_memset
	add	esp, 12					; 0000000cH

; 14   : 	CHAR				outputBuffer[OUT_BUFFER_SIZE]	= {0};	// від драйвера

	mov	BYTE PTR _outputBuffer$[ebp], 0
	push	255					; 000000ffH
	push	0
	lea	eax, DWORD PTR _outputBuffer$[ebp+1]
	push	eax
	call	_memset
	add	esp, 12					; 0000000cH

; 15   : 	
; 16   : 	SetConsoleTitle(_TEXT("Програма управління драйвером"));

	push	OFFSET ??_C@_0BO@OGPOAGEO@?O?p?n?c?p?$OA?l?$OA?5?s?o?p?$OA?b?k?$LD?m?m?$PP?5?d?p?$OA?i?b?e?p?n?l?$AA@
	call	DWORD PTR __imp__SetConsoleTitleA@4

; 17   : 	scm = OpenSCManager(NULL, NULL, SC_MANAGER_ALL_ACCESS);

	push	983103					; 000f003fH
	push	0
	push	0
	call	DWORD PTR __imp__OpenSCManagerA@12
	mov	DWORD PTR _scm$[ebp], eax

; 18   : 	if(!scm)

	cmp	DWORD PTR _scm$[ebp], 0
	jne	SHORT $LN35@main

; 19   : 	{
; 20   : 		lastError = GetLastError();

	call	DWORD PTR __imp__GetLastError@0
	mov	DWORD PTR _lastError$[ebp], eax

; 21   : 		_tprintf(_TEXT("\nCan't open Service Control Manager. ErrorCode=0x%0X"), lastError);

	mov	ecx, DWORD PTR _lastError$[ebp]
	push	ecx
	push	OFFSET ??_C@_0DF@NHKGILHH@?6Can?8t?5open?5Service?5Control?5Mana@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 22   : 		return lastError;

	mov	eax, DWORD PTR _lastError$[ebp]
	jmp	$LN36@main
$LN35@main:

; 23   : 	}
; 24   : 
; 25   : 	service = OpenService(scm, serviceName,	SERVICE_START + SERVICE_STOP);

	push	48					; 00000030H
	push	OFFSET _serviceName
	mov	edx, DWORD PTR _scm$[ebp]
	push	edx
	call	DWORD PTR __imp__OpenServiceA@12
	mov	DWORD PTR _service$[ebp], eax

; 26   : 	if(service)

	cmp	DWORD PTR _service$[ebp], 0
	je	SHORT $LN34@main

; 27   : 	{
; 28   : 		statusBefore |= SERVICE_OPENED;

	mov	eax, DWORD PTR _statusBefore$[ebp]
	or	eax, 8
	mov	DWORD PTR _statusBefore$[ebp], eax

; 29   : 		_tprintf(_TEXT("\nService '%s' opened"), serviceName);

	push	OFFSET _serviceName
	push	OFFSET ??_C@_0BF@HJJJKPCP@?6Service?5?8?$CFs?8?5opened?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 30   : 	}
; 31   : 	else

	jmp	$LN33@main
$LN34@main:

; 32   : 	{
; 33   : 		_tprintf(_TEXT("\nCan't open service '%s'. ErrorCode=0x%0X.\nTry create..."), 
; 34   : 					serviceName, GetLastError());

	call	DWORD PTR __imp__GetLastError@0
	push	eax
	push	OFFSET _serviceName
	push	OFFSET ??_C@_0DJ@MAJKNFIF@?6Can?8t?5open?5service?5?8?$CFs?8?4?5ErrorC@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH

; 35   : 		counterBytes = GetFullPathName(
; 36   : 								imageName,
; 37   : 								sizeof (fullImagePath)/sizeof(TCHAR), 
; 38   : 								fullImagePath, NULL);

	push	0
	lea	ecx, DWORD PTR _fullImagePath$[ebp]
	push	ecx
	push	520					; 00000208H
	push	OFFSET _imageName
	call	DWORD PTR __imp__GetFullPathNameA@16
	mov	DWORD PTR _counterBytes$[ebp], eax

; 39   : 		if(counterBytes == 0 || counterBytes > sizeof (fullImagePath)/sizeof(TCHAR))

	cmp	DWORD PTR _counterBytes$[ebp], 0
	je	SHORT $LN31@main
	cmp	DWORD PTR _counterBytes$[ebp], 520	; 00000208H
	jbe	SHORT $LN32@main
$LN31@main:

; 40   : 		{
; 41   : 			lastError = GetLastError();

	call	DWORD PTR __imp__GetLastError@0
	mov	DWORD PTR _lastError$[ebp], eax

; 42   : 			_tprintf(_TEXT("\nCan't get full path for service image '%s'. ErrorCode=0x%0X."), 
; 43   : 						imageName, lastError);

	mov	edx, DWORD PTR _lastError$[ebp]
	push	edx
	push	OFFSET _imageName
	push	OFFSET ??_C@_0DO@DMADPKCI@?6Can?8t?5get?5full?5path?5for?5service@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH

; 44   : 		}
; 45   : 		else

	jmp	$LN33@main
$LN32@main:

; 46   : 		{
; 47   : 			service = CreateService(
; 48   : 							scm,
; 49   : 							serviceName,
; 50   : 							serviceName,
; 51   : 							SERVICE_START + SERVICE_STOP + DELETE,
; 52   : 							SERVICE_KERNEL_DRIVER,
; 53   : 							SERVICE_DEMAND_START,
; 54   : 							SERVICE_ERROR_IGNORE,
; 55   : 							fullImagePath,
; 56   : 							NULL, NULL, NULL, NULL, NULL);

	push	0
	push	0
	push	0
	push	0
	push	0
	lea	eax, DWORD PTR _fullImagePath$[ebp]
	push	eax
	push	0
	push	3
	push	1
	push	65584					; 00010030H
	push	OFFSET _serviceName
	push	OFFSET _serviceName
	mov	ecx, DWORD PTR _scm$[ebp]
	push	ecx
	call	DWORD PTR __imp__CreateServiceA@52
	mov	DWORD PTR _service$[ebp], eax

; 57   : 			if(service)

	cmp	DWORD PTR _service$[ebp], 0
	je	SHORT $LN29@main

; 58   : 			{
; 59   : 				statusBefore |= SERVICE_INSTALLED;

	mov	edx, DWORD PTR _statusBefore$[ebp]
	or	edx, 1
	mov	DWORD PTR _statusBefore$[ebp], edx

; 60   : 				_tprintf(_TEXT("\nService '%s' created"), serviceName);

	push	OFFSET _serviceName
	push	OFFSET ??_C@_0BG@BDOMDCP@?6Service?5?8?$CFs?8?5created?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 61   : 			}
; 62   : 			else

	jmp	SHORT $LN33@main
$LN29@main:

; 63   : 			{
; 64   : 				lastError = GetLastError();

	call	DWORD PTR __imp__GetLastError@0
	mov	DWORD PTR _lastError$[ebp], eax

; 65   : 				_tprintf(_TEXT("\nCan't create service '%s'. ErrorCode=0x%0X."),
; 66   : 						 serviceName, lastError);

	mov	eax, DWORD PTR _lastError$[ebp]
	push	eax
	push	OFFSET _serviceName
	push	OFFSET ??_C@_0CN@LJAJMOLA@?6Can?8t?5create?5service?5?8?$CFs?8?4?5Erro@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH
$LN33@main:

; 67   : 			}
; 68   : 		}
; 69   : 	}
; 70   : 
; 71   : 	if(service)

	cmp	DWORD PTR _service$[ebp], 0
	je	$LN27@main

; 72   : 	{
; 73   : 		if( StartService(service, 0, NULL) )

	push	0
	push	0
	mov	ecx, DWORD PTR _service$[ebp]
	push	ecx
	call	DWORD PTR __imp__StartServiceA@12
	test	eax, eax
	je	SHORT $LN26@main

; 74   : 		{
; 75   : 			statusBefore |= SERVICE_STARTED;

	mov	edx, DWORD PTR _statusBefore$[ebp]
	or	edx, 2
	mov	DWORD PTR _statusBefore$[ebp], edx

; 76   : 			_tprintf(_TEXT("\nService '%s' started"), serviceName);

	push	OFFSET _serviceName
	push	OFFSET ??_C@_0BG@KCIEGIHK@?6Service?5?8?$CFs?8?5started?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 77   : 		}
; 78   : 		else

	jmp	SHORT $LN25@main
$LN26@main:

; 79   : 		{
; 80   : 			lastError = GetLastError();

	call	DWORD PTR __imp__GetLastError@0
	mov	DWORD PTR _lastError$[ebp], eax

; 81   : 			if(ERROR_SERVICE_ALREADY_RUNNING == lastError)

	cmp	DWORD PTR _lastError$[ebp], 1056	; 00000420H
	jne	SHORT $LN24@main

; 82   : 			{
; 83   : 				_tprintf(_TEXT("\nService '%s' already running"), serviceName);

	push	OFFSET _serviceName
	push	OFFSET ??_C@_0BO@FMFCEEJB@?6Service?5?8?$CFs?8?5already?5running?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 84   : 				statusBefore |= SERVICE_RUNNING;

	mov	eax, DWORD PTR _statusBefore$[ebp]
	or	eax, 4
	mov	DWORD PTR _statusBefore$[ebp], eax

; 85   : 			}
; 86   : 			else

	jmp	SHORT $LN25@main
$LN24@main:

; 87   : 			{
; 88   : 				_tprintf(_TEXT("\nCan't start service '%s'. ErrorCode=0x%08X."),
; 89   : 							serviceName, lastError);

	mov	ecx, DWORD PTR _lastError$[ebp]
	push	ecx
	push	OFFSET _serviceName
	push	OFFSET ??_C@_0CN@NIILNDPD@?6Can?8t?5start?5service?5?8?$CFs?8?4?5Error@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH
$LN25@main:

; 90   : 			}
; 91   : 		}
; 92   : 		
; 93   : 		if( (statusBefore & SERVICE_STARTED) || (statusBefore & SERVICE_RUNNING) )

	mov	edx, DWORD PTR _statusBefore$[ebp]
	and	edx, 2
	jne	SHORT $LN21@main
	mov	eax, DWORD PTR _statusBefore$[ebp]
	and	eax, 4
	je	$LN27@main
$LN21@main:

; 94   : 		{
; 95   : 			device = CreateFile(
; 96   : 						symbolicLinkName,
; 97   : 						GENERIC_READ + GENERIC_WRITE, 0, NULL,
; 98   : 						OPEN_EXISTING, 0, NULL);

	push	0
	push	0
	push	3
	push	0
	push	0
	push	-1073741824				; c0000000H
	push	OFFSET _symbolicLinkName
	call	DWORD PTR __imp__CreateFileA@28
	mov	DWORD PTR _device$[ebp], eax

; 99   : 			
; 100  : 			if(INVALID_HANDLE_VALUE == device)

	cmp	DWORD PTR _device$[ebp], -1
	jne	SHORT $LN20@main

; 101  : 			{
; 102  : 				lastError = GetLastError();

	call	DWORD PTR __imp__GetLastError@0
	mov	DWORD PTR _lastError$[ebp], eax

; 103  : 				_tprintf(_TEXT("\nCan't open symbolik link '%s'. ErrorCode=0x%0X."),
; 104  : 							symbolicLinkName, lastError);

	mov	ecx, DWORD PTR _lastError$[ebp]
	push	ecx
	push	OFFSET _symbolicLinkName
	push	OFFSET ??_C@_0DB@HNPALFON@?6Can?8t?5open?5symbolik?5link?5?8?$CFs?8?4?5@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH

; 105  : 			}
; 106  : 			else

	jmp	$LN27@main
$LN20@main:

; 107  : 			{
; 108  : 				_tprintf(_TEXT("\nEnter first string\n"));

	push	OFFSET ??_C@_0BF@KAODGIKH@?6Enter?5first?5string?6?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 4

; 109  : 				scanf_s( "%s", &inputBuffer, sizeof(inputBuffer)-1 );

	push	255					; 000000ffH
	lea	edx, DWORD PTR _inputBuffer$[ebp]
	push	edx
	push	OFFSET ??_C@_02DKCKIIND@?$CFs?$AA@
	call	_scanf_s
	add	esp, 12					; 0000000cH

; 110  : 				if(DeviceIoControl(	device,
; 111  : 									IOCTL_BUFFERED_WRITE,
; 112  : 									&inputBuffer,
; 113  : 									strlen(inputBuffer),
; 114  : 									(PVOID)NULL, 
; 115  : 									(DWORD)NULL,
; 116  : 									&counterBytes, NULL)	)

	lea	eax, DWORD PTR _inputBuffer$[ebp]
	mov	DWORD PTR tv438[ebp], eax
	mov	ecx, DWORD PTR tv438[ebp]
	add	ecx, 1
	mov	DWORD PTR tv441[ebp], ecx
$LL38@main:
	mov	edx, DWORD PTR tv438[ebp]
	mov	al, BYTE PTR [edx]
	mov	BYTE PTR tv444[ebp], al
	add	DWORD PTR tv438[ebp], 1
	cmp	BYTE PTR tv444[ebp], 0
	jne	SHORT $LL38@main
	mov	ecx, DWORD PTR tv438[ebp]
	sub	ecx, DWORD PTR tv441[ebp]
	mov	DWORD PTR tv207[ebp], ecx
	push	0
	lea	edx, DWORD PTR _counterBytes$[ebp]
	push	edx
	push	0
	push	0
	mov	eax, DWORD PTR tv207[ebp]
	push	eax
	lea	ecx, DWORD PTR _inputBuffer$[ebp]
	push	ecx
	push	2236416					; 00222000H
	mov	edx, DWORD PTR _device$[ebp]
	push	edx
	call	DWORD PTR __imp__DeviceIoControl@32
	test	eax, eax
	je	SHORT $LN18@main

; 117  : 				
; 118  : 				{
; 119  : 					_tprintf(_TEXT("\nIOCTL_BUFFERED_WRITE written %d bytes"), counterBytes);

	mov	eax, DWORD PTR _counterBytes$[ebp]
	push	eax
	push	OFFSET ??_C@_0CH@CJICLIFN@?6IOCTL_BUFFERED_WRITE?5written?5?$CFd@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 120  : 				}
; 121  : 				else

	jmp	SHORT $LN17@main
$LN18@main:

; 122  : 				{
; 123  : 					_tprintf(_TEXT("\nIOCTL_BUFFERED_WRITE failed. ErrorCode=0x%08X."), GetLastError());

	call	DWORD PTR __imp__GetLastError@0
	push	eax
	push	OFFSET ??_C@_0DA@CILLFPND@?6IOCTL_BUFFERED_WRITE?5failed?4?5Er@
	call	DWORD PTR __imp__printf
	add	esp, 8
$LN17@main:

; 124  : 				}
; 125  : 				
; 126  : 				// Result of reading the file
; 127  : 				_tprintf(_TEXT("\nResult of reading the file. Buffered method: "));

	push	OFFSET ??_C@_0CP@JLFJOLBL@?6Result?5of?5reading?5the?5file?4?5Buf@
	call	DWORD PTR __imp__printf
	add	esp, 4

; 128  : 				if(DeviceIoControl(	device,
; 129  : 									IOCTL_BUFFERED_READ,
; 130  : 									(PVOID)NULL, 
; 131  : 									(DWORD)NULL,
; 132  : 									&outputBuffer,
; 133  : 									strlen(inputBuffer),
; 134  : 									&counterBytes, NULL)	)

	lea	ecx, DWORD PTR _inputBuffer$[ebp]
	mov	DWORD PTR tv456[ebp], ecx
	mov	edx, DWORD PTR tv456[ebp]
	add	edx, 1
	mov	DWORD PTR tv459[ebp], edx
$LL39@main:
	mov	eax, DWORD PTR tv456[ebp]
	mov	cl, BYTE PTR [eax]
	mov	BYTE PTR tv462[ebp], cl
	add	DWORD PTR tv456[ebp], 1
	cmp	BYTE PTR tv462[ebp], 0
	jne	SHORT $LL39@main
	mov	edx, DWORD PTR tv456[ebp]
	sub	edx, DWORD PTR tv459[ebp]
	mov	DWORD PTR tv224[ebp], edx
	push	0
	lea	eax, DWORD PTR _counterBytes$[ebp]
	push	eax
	mov	ecx, DWORD PTR tv224[ebp]
	push	ecx
	lea	edx, DWORD PTR _outputBuffer$[ebp]
	push	edx
	push	0
	push	0
	push	2236420					; 00222004H
	mov	eax, DWORD PTR _device$[ebp]
	push	eax
	call	DWORD PTR __imp__DeviceIoControl@32
	test	eax, eax
	je	SHORT $LN16@main

; 135  : 				
; 136  : 				{
; 137  : 					_tprintf(_TEXT("%s\n"), outputBuffer);

	lea	ecx, DWORD PTR _outputBuffer$[ebp]
	push	ecx
	push	OFFSET ??_C@_03OFAPEBGM@?$CFs?6?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 138  : 					_tprintf(_TEXT("IOCTL_BUFFERED_READ read %d bytes\n"), counterBytes);

	mov	edx, DWORD PTR _counterBytes$[ebp]
	push	edx
	push	OFFSET ??_C@_0CD@BLPPFIAH@IOCTL_BUFFERED_READ?5read?5?$CFd?5byte@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 139  : 				}
; 140  : 				else

	jmp	SHORT $LN15@main
$LN16@main:

; 141  : 				{
; 142  : 					_tprintf(_TEXT("\nIOCTL_BUFFERED_READ failed. ErrorCode=0x%08X."), GetLastError());

	call	DWORD PTR __imp__GetLastError@0
	push	eax
	push	OFFSET ??_C@_0CP@DLOLIDNB@?6IOCTL_BUFFERED_READ?5failed?4?5Err@
	call	DWORD PTR __imp__printf
	add	esp, 8
$LN15@main:

; 143  : 				}
; 144  : 				
; 145  : 				_tprintf(_TEXT("\nEnter second string\n"));

	push	OFFSET ??_C@_0BG@JAJKBBNG@?6Enter?5second?5string?6?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 4

; 146  : 				scanf_s( "%s", &inputBuffer, sizeof(inputBuffer)-1 );

	push	255					; 000000ffH
	lea	eax, DWORD PTR _inputBuffer$[ebp]
	push	eax
	push	OFFSET ??_C@_02DKCKIIND@?$CFs?$AA@
	call	_scanf_s
	add	esp, 12					; 0000000cH

; 147  : 				if(DeviceIoControl(	device,
; 148  : 									IOCTL_DIRECT_WRITE,
; 149  : 									&inputBuffer,
; 150  : 									strlen(inputBuffer),
; 151  : 									(PVOID)NULL, 
; 152  : 									(DWORD)NULL,
; 153  : 									&counterBytes, NULL)	)

	lea	ecx, DWORD PTR _inputBuffer$[ebp]
	mov	DWORD PTR tv476[ebp], ecx
	mov	edx, DWORD PTR tv476[ebp]
	add	edx, 1
	mov	DWORD PTR tv479[ebp], edx
$LL40@main:
	mov	eax, DWORD PTR tv476[ebp]
	mov	cl, BYTE PTR [eax]
	mov	BYTE PTR tv482[ebp], cl
	add	DWORD PTR tv476[ebp], 1
	cmp	BYTE PTR tv482[ebp], 0
	jne	SHORT $LL40@main
	mov	edx, DWORD PTR tv476[ebp]
	sub	edx, DWORD PTR tv479[ebp]
	mov	DWORD PTR tv250[ebp], edx
	push	0
	lea	eax, DWORD PTR _counterBytes$[ebp]
	push	eax
	push	0
	push	0
	mov	ecx, DWORD PTR tv250[ebp]
	push	ecx
	lea	edx, DWORD PTR _inputBuffer$[ebp]
	push	edx
	push	2236417					; 00222001H
	mov	eax, DWORD PTR _device$[ebp]
	push	eax
	call	DWORD PTR __imp__DeviceIoControl@32
	test	eax, eax
	je	SHORT $LN14@main

; 154  : 				
; 155  : 				{
; 156  : 					_tprintf(_TEXT("\nIOCTL_DIRECT_WRITE written %d bytes"), counterBytes);

	mov	ecx, DWORD PTR _counterBytes$[ebp]
	push	ecx
	push	OFFSET ??_C@_0CF@JNFGMALK@?6IOCTL_DIRECT_WRITE?5written?5?$CFd?5b@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 157  : 				}
; 158  : 				else

	jmp	SHORT $LN13@main
$LN14@main:

; 159  : 				{
; 160  : 					_tprintf(_TEXT("\nIOCTL_DIRECT_WRITE failed. ErrorCode=0x%08X."), GetLastError());

	call	DWORD PTR __imp__GetLastError@0
	push	eax
	push	OFFSET ??_C@_0CO@NHIOEPOB@?6IOCTL_DIRECT_WRITE?5failed?4?5Erro@
	call	DWORD PTR __imp__printf
	add	esp, 8
$LN13@main:

; 161  : 				}
; 162  : 				
; 163  : 				memset(outputBuffer, 0, strlen(outputBuffer));

	lea	edx, DWORD PTR _outputBuffer$[ebp]
	mov	DWORD PTR tv494[ebp], edx
	mov	eax, DWORD PTR tv494[ebp]
	add	eax, 1
	mov	DWORD PTR tv497[ebp], eax
$LL41@main:
	mov	ecx, DWORD PTR tv494[ebp]
	mov	dl, BYTE PTR [ecx]
	mov	BYTE PTR tv500[ebp], dl
	add	DWORD PTR tv494[ebp], 1
	cmp	BYTE PTR tv500[ebp], 0
	jne	SHORT $LL41@main
	mov	eax, DWORD PTR tv494[ebp]
	sub	eax, DWORD PTR tv497[ebp]
	mov	DWORD PTR tv264[ebp], eax
	mov	ecx, DWORD PTR tv264[ebp]
	push	ecx
	push	0
	lea	edx, DWORD PTR _outputBuffer$[ebp]
	push	edx
	call	_memset
	add	esp, 12					; 0000000cH

; 164  : 				_tprintf(_TEXT("\nResult of reading the file. Direct method: "));

	push	OFFSET ??_C@_0CN@PIHJCCCG@?6Result?5of?5reading?5the?5file?4?5Dir@
	call	DWORD PTR __imp__printf
	add	esp, 4

; 165  : 				if(DeviceIoControl(	device,
; 166  : 									IOCTL_DIRECT_READ,
; 167  : 									(PVOID)NULL, 
; 168  : 									(DWORD)NULL,
; 169  : 									&outputBuffer,
; 170  : 									strlen(inputBuffer),
; 171  : 									&counterBytes, NULL)	)

	lea	eax, DWORD PTR _inputBuffer$[ebp]
	mov	DWORD PTR tv507[ebp], eax
	mov	ecx, DWORD PTR tv507[ebp]
	add	ecx, 1
	mov	DWORD PTR tv510[ebp], ecx
$LL42@main:
	mov	edx, DWORD PTR tv507[ebp]
	mov	al, BYTE PTR [edx]
	mov	BYTE PTR tv513[ebp], al
	add	DWORD PTR tv507[ebp], 1
	cmp	BYTE PTR tv513[ebp], 0
	jne	SHORT $LL42@main
	mov	ecx, DWORD PTR tv507[ebp]
	sub	ecx, DWORD PTR tv510[ebp]
	mov	DWORD PTR tv273[ebp], ecx
	push	0
	lea	edx, DWORD PTR _counterBytes$[ebp]
	push	edx
	mov	eax, DWORD PTR tv273[ebp]
	push	eax
	lea	ecx, DWORD PTR _outputBuffer$[ebp]
	push	ecx
	push	0
	push	0
	push	2236421					; 00222005H
	mov	edx, DWORD PTR _device$[ebp]
	push	edx
	call	DWORD PTR __imp__DeviceIoControl@32
	test	eax, eax
	je	SHORT $LN12@main

; 172  : 				
; 173  : 				{
; 174  : 					_tprintf(_TEXT("%s\n"), outputBuffer);

	lea	eax, DWORD PTR _outputBuffer$[ebp]
	push	eax
	push	OFFSET ??_C@_03OFAPEBGM@?$CFs?6?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 175  : 					_tprintf(_TEXT("IOCTL_DIRECT_READ read %d bytes\n"), counterBytes);

	mov	ecx, DWORD PTR _counterBytes$[ebp]
	push	ecx
	push	OFFSET ??_C@_0CB@PHIDBDDP@IOCTL_DIRECT_READ?5read?5?$CFd?5bytes?6@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 176  : 				}
; 177  : 				else

	jmp	SHORT $LN11@main
$LN12@main:

; 178  : 				{
; 179  : 					_tprintf(_TEXT("\nIOCTL_DIRECT_READ failed. ErrorCode=0x%08X."), GetLastError());

	call	DWORD PTR __imp__GetLastError@0
	push	eax
	push	OFFSET ??_C@_0CN@BJBMBAI@?6IOCTL_DIRECT_READ?5failed?4?5Error@
	call	DWORD PTR __imp__printf
	add	esp, 8
$LN11@main:

; 180  : 				}
; 181  : 				
; 182  : 				_tprintf(_TEXT("\nEnter third string\n"));

	push	OFFSET ??_C@_0BF@GBADFODJ@?6Enter?5third?5string?6?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 4

; 183  : 				scanf_s( "%s", &inputBuffer, sizeof(inputBuffer)-1 );

	push	255					; 000000ffH
	lea	edx, DWORD PTR _inputBuffer$[ebp]
	push	edx
	push	OFFSET ??_C@_02DKCKIIND@?$CFs?$AA@
	call	_scanf_s
	add	esp, 12					; 0000000cH

; 184  : 				if(DeviceIoControl(	device,
; 185  : 									IOCTL_NEITHER_WRITE,
; 186  : 									&inputBuffer,
; 187  : 									strlen(inputBuffer),
; 188  : 									(PVOID)NULL, 
; 189  : 									(DWORD)NULL,
; 190  : 									&counterBytes, NULL)	)

	lea	eax, DWORD PTR _inputBuffer$[ebp]
	mov	DWORD PTR tv527[ebp], eax
	mov	ecx, DWORD PTR tv527[ebp]
	add	ecx, 1
	mov	DWORD PTR tv530[ebp], ecx
$LL43@main:
	mov	edx, DWORD PTR tv527[ebp]
	mov	al, BYTE PTR [edx]
	mov	BYTE PTR tv533[ebp], al
	add	DWORD PTR tv527[ebp], 1
	cmp	BYTE PTR tv533[ebp], 0
	jne	SHORT $LL43@main
	mov	ecx, DWORD PTR tv527[ebp]
	sub	ecx, DWORD PTR tv530[ebp]
	mov	DWORD PTR tv299[ebp], ecx
	push	0
	lea	edx, DWORD PTR _counterBytes$[ebp]
	push	edx
	push	0
	push	0
	mov	eax, DWORD PTR tv299[ebp]
	push	eax
	lea	ecx, DWORD PTR _inputBuffer$[ebp]
	push	ecx
	push	2236419					; 00222003H
	mov	edx, DWORD PTR _device$[ebp]
	push	edx
	call	DWORD PTR __imp__DeviceIoControl@32
	test	eax, eax
	je	SHORT $LN10@main

; 191  : 				
; 192  : 				{
; 193  : 					_tprintf(_TEXT("\nIOCTL_NEITHER_WRITE written %d bytes"), counterBytes);

	mov	eax, DWORD PTR _counterBytes$[ebp]
	push	eax
	push	OFFSET ??_C@_0CG@CPNPLIPC@?6IOCTL_NEITHER_WRITE?5written?5?$CFd?5@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 194  : 				}
; 195  : 				else

	jmp	SHORT $LN9@main
$LN10@main:

; 196  : 				{
; 197  : 					_tprintf(_TEXT("\nIOCTL_NEITHER_WRITE failed. ErrorCode=0x%08X."), GetLastError());

	call	DWORD PTR __imp__GetLastError@0
	push	eax
	push	OFFSET ??_C@_0CP@IHPNHJIE@?6IOCTL_NEITHER_WRITE?5failed?4?5Err@
	call	DWORD PTR __imp__printf
	add	esp, 8
$LN9@main:

; 198  : 				}
; 199  : 				
; 200  : 				memset(outputBuffer, 0, strlen(outputBuffer));

	lea	ecx, DWORD PTR _outputBuffer$[ebp]
	mov	DWORD PTR tv545[ebp], ecx
	mov	edx, DWORD PTR tv545[ebp]
	add	edx, 1
	mov	DWORD PTR tv548[ebp], edx
$LL44@main:
	mov	eax, DWORD PTR tv545[ebp]
	mov	cl, BYTE PTR [eax]
	mov	BYTE PTR tv551[ebp], cl
	add	DWORD PTR tv545[ebp], 1
	cmp	BYTE PTR tv551[ebp], 0
	jne	SHORT $LL44@main
	mov	edx, DWORD PTR tv545[ebp]
	sub	edx, DWORD PTR tv548[ebp]
	mov	DWORD PTR tv313[ebp], edx
	mov	eax, DWORD PTR tv313[ebp]
	push	eax
	push	0
	lea	ecx, DWORD PTR _outputBuffer$[ebp]
	push	ecx
	call	_memset
	add	esp, 12					; 0000000cH

; 201  : 				_tprintf(_TEXT("\nResult of reading the file. Neither method: "));

	push	OFFSET ??_C@_0CO@HDLHPMAL@?6Result?5of?5reading?5the?5file?4?5Nei@
	call	DWORD PTR __imp__printf
	add	esp, 4

; 202  : 				if(DeviceIoControl(	device,
; 203  : 									IOCTL_NEITHER_READ,
; 204  : 									(PVOID)NULL, 
; 205  : 									(DWORD)NULL,
; 206  : 									&outputBuffer,
; 207  : 									strlen(inputBuffer),
; 208  : 									&counterBytes, NULL)	)

	lea	edx, DWORD PTR _inputBuffer$[ebp]
	mov	DWORD PTR tv558[ebp], edx
	mov	eax, DWORD PTR tv558[ebp]
	add	eax, 1
	mov	DWORD PTR tv561[ebp], eax
$LL45@main:
	mov	ecx, DWORD PTR tv558[ebp]
	mov	dl, BYTE PTR [ecx]
	mov	BYTE PTR tv564[ebp], dl
	add	DWORD PTR tv558[ebp], 1
	cmp	BYTE PTR tv564[ebp], 0
	jne	SHORT $LL45@main
	mov	eax, DWORD PTR tv558[ebp]
	sub	eax, DWORD PTR tv561[ebp]
	mov	DWORD PTR tv322[ebp], eax
	push	0
	lea	ecx, DWORD PTR _counterBytes$[ebp]
	push	ecx
	mov	edx, DWORD PTR tv322[ebp]
	push	edx
	lea	eax, DWORD PTR _outputBuffer$[ebp]
	push	eax
	push	0
	push	0
	push	2236423					; 00222007H
	mov	ecx, DWORD PTR _device$[ebp]
	push	ecx
	call	DWORD PTR __imp__DeviceIoControl@32
	test	eax, eax
	je	SHORT $LN8@main

; 209  : 				
; 210  : 				{
; 211  : 					_tprintf(_TEXT("%s\n"), outputBuffer);

	lea	edx, DWORD PTR _outputBuffer$[ebp]
	push	edx
	push	OFFSET ??_C@_03OFAPEBGM@?$CFs?6?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 212  : 					_tprintf(_TEXT("IOCTL_DIRECT_READ read %d bytes\n"), counterBytes);

	mov	eax, DWORD PTR _counterBytes$[ebp]
	push	eax
	push	OFFSET ??_C@_0CB@PHIDBDDP@IOCTL_DIRECT_READ?5read?5?$CFd?5bytes?6@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 213  : 				}
; 214  : 				else

	jmp	SHORT $LN7@main
$LN8@main:

; 215  : 				{
; 216  : 					_tprintf(_TEXT("\nIOCTL_DIRECT_READ failed. ErrorCode=0x%08X."), GetLastError());

	call	DWORD PTR __imp__GetLastError@0
	push	eax
	push	OFFSET ??_C@_0CN@BJBMBAI@?6IOCTL_DIRECT_READ?5failed?4?5Error@
	call	DWORD PTR __imp__printf
	add	esp, 8
$LN7@main:

; 217  : 				}
; 218  : 				
; 219  : 				CloseHandle(device);

	mov	ecx, DWORD PTR _device$[ebp]
	push	ecx
	call	DWORD PTR __imp__CloseHandle@4
$LN27@main:

; 220  : 			}
; 221  : 		}
; 222  : 	}
; 223  : 
; 224  : 	if(statusBefore & SERVICE_STARTED)

	mov	edx, DWORD PTR _statusBefore$[ebp]
	and	edx, 2
	je	SHORT $LN6@main

; 225  : 	{
; 226  : 		if(ControlService(service, SERVICE_CONTROL_STOP, &serviceStatus))

	lea	eax, DWORD PTR _serviceStatus$[ebp]
	push	eax
	push	1
	mov	ecx, DWORD PTR _service$[ebp]
	push	ecx
	call	DWORD PTR __imp__ControlService@12
	test	eax, eax
	je	SHORT $LN5@main

; 227  : 		{
; 228  : 			_tprintf(_TEXT("\nService '%s' stopped"), serviceName);

	push	OFFSET _serviceName
	push	OFFSET ??_C@_0BG@GNCMMNDN@?6Service?5?8?$CFs?8?5stopped?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 229  : 		}
; 230  : 		else

	jmp	SHORT $LN6@main
$LN5@main:

; 231  : 		{
; 232  : 			lastError = GetLastError();

	call	DWORD PTR __imp__GetLastError@0
	mov	DWORD PTR _lastError$[ebp], eax

; 233  : 			_tprintf(_TEXT("\nCan't stop service '%s'. ErrorCode=0x%0X."),
; 234  : 						 serviceName, lastError);

	mov	edx, DWORD PTR _lastError$[ebp]
	push	edx
	push	OFFSET _serviceName
	push	OFFSET ??_C@_0CL@DNLIHKOL@?6Can?8t?5stop?5service?5?8?$CFs?8?4?5ErrorC@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH
$LN6@main:

; 235  : 		}
; 236  : 	}
; 237  : 	if( (statusBefore & SERVICE_INSTALLED) && (SERVICE_STOPPED == serviceStatus.dwCurrentState) )

	mov	eax, DWORD PTR _statusBefore$[ebp]
	and	eax, 1
	je	SHORT $LN3@main
	cmp	DWORD PTR _serviceStatus$[ebp+4], 1
	jne	SHORT $LN3@main

; 238  : 	{
; 239  : 		if( DeleteService(service) )

	mov	ecx, DWORD PTR _service$[ebp]
	push	ecx
	call	DWORD PTR __imp__DeleteService@4
	test	eax, eax
	je	SHORT $LN2@main

; 240  : 		{
; 241  : 			_tprintf(_TEXT("\nService '%s' deleted"), serviceName);

	push	OFFSET _serviceName
	push	OFFSET ??_C@_0BG@HLANJPHO@?6Service?5?8?$CFs?8?5deleted?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 8

; 242  : 		}
; 243  : 		else

	jmp	SHORT $LN3@main
$LN2@main:

; 244  : 		{
; 245  : 			lastError = GetLastError();

	call	DWORD PTR __imp__GetLastError@0
	mov	DWORD PTR _lastError$[ebp], eax

; 246  : 			_tprintf(_TEXT("\nCan't delete service '%s'. ErrorCode=0x%0X."),
; 247  : 						 serviceName, lastError);

	mov	edx, DWORD PTR _lastError$[ebp]
	push	edx
	push	OFFSET _serviceName
	push	OFFSET ??_C@_0CN@JEBFDAOH@?6Can?8t?5delete?5service?5?8?$CFs?8?4?5Erro@
	call	DWORD PTR __imp__printf
	add	esp, 12					; 0000000cH
$LN3@main:

; 248  : 		}
; 249  : 	}
; 250  : 
; 251  : 	CloseServiceHandle(service);

	mov	eax, DWORD PTR _service$[ebp]
	push	eax
	call	DWORD PTR __imp__CloseServiceHandle@4

; 252  : 	CloseServiceHandle(scm);

	mov	ecx, DWORD PTR _scm$[ebp]
	push	ecx
	call	DWORD PTR __imp__CloseServiceHandle@4

; 253  : 	_tprintf(_TEXT("\nPress 'Enter' to exit\n"));

	push	OFFSET ??_C@_0BI@LGCNFJIL@?6Press?5?8Enter?8?5to?5exit?6?$AA@
	call	DWORD PTR __imp__printf
	add	esp, 4

; 254  : 	_gettchar();_gettchar();

	call	DWORD PTR __imp__getchar
	call	DWORD PTR __imp__getchar

; 255  : 	return lastError;

	mov	eax, DWORD PTR _lastError$[ebp]
$LN36@main:

; 256  : }

	mov	ecx, DWORD PTR __$ArrayPad$[ebp]
	xor	ecx, ebp
	call	@__security_check_cookie@4
	mov	esp, ebp
	pop	ebp
	ret	0
_main	ENDP
_TEXT	ENDS
END
